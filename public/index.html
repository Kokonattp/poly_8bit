<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyTrader Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --primary-bg: #eef2ff;
            --success: #10b981;
            --success-bg: #d1fae5;
            --warning: #f59e0b;
            --warning-bg: #fef3c7;
            --error: #ef4444;
            --error-bg: #fee2e2;
            --info: #3b82f6;
            --info-bg: #dbeafe;
            --bg: #f8fafc;
            --bg-card: #ffffff;
            --text: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }
        
        [data-theme="dark"] {
            --primary: #818cf8;
            --primary-bg: #1e1b4b;
            --success: #34d399;
            --success-bg: #064e3b;
            --warning: #fbbf24;
            --warning-bg: #78350f;
            --error: #f87171;
            --error-bg: #7f1d1d;
            --info: #60a5fa;
            --info-bg: #1e3a8a;
            --bg: #0f172a;
            --bg-card: #1e293b;
            --text: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #334155;
            --border-light: #1e293b;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Prompt', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
        
        .header { background: var(--bg-card); border-bottom: 1px solid var(--border); padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon { width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; }
        .logo-text { font-size: 20px; font-weight: 600; }
        .header-actions { display: flex; align-items: center; gap: 12px; }
        .status-pill { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--success-bg); color: var(--success); border-radius: 50px; font-size: 13px; font-weight: 500; }
        .status-pill.offline { background: var(--error-bg); color: var(--error); }
        .status-dot { width: 8px; height: 8px; background: currentColor; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .icon-btn { width: 44px; height: 44px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .icon-btn:hover { background: var(--border-light); }
        
        .main { max-width: 1400px; margin: 0 auto; padding: 24px; }
        .tabs { display: flex; gap: 8px; margin-bottom: 24px; background: var(--bg-card); padding: 6px; border-radius: 16px; border: 1px solid var(--border); width: fit-content; }
        .tab-btn { padding: 12px 24px; border: none; background: transparent; color: var(--text-secondary); font-family: inherit; font-size: 14px; font-weight: 500; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .tab-btn:hover { background: var(--border-light); }
        .tab-btn.active { background: var(--primary); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .controls-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 24px; }
        .controls-row { display: flex; gap: 16px; flex-wrap: wrap; align-items: flex-end; }
        .control-group { display: flex; flex-direction: column; gap: 6px; }
        .control-group label { font-size: 12px; font-weight: 500; color: var(--text-secondary); }
        .input-field { padding: 12px 16px; border: 1px solid var(--border); border-radius: 10px; background: var(--bg); color: var(--text); font-family: inherit; font-size: 14px; width: 120px; }
        .input-field:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-bg); }
        .search-field { flex: 1; min-width: 250px; }
        .search-field .input-field { width: 100%; }
        
        .btn { padding: 12px 24px; border: none; border-radius: 10px; font-family: inherit; font-size: 14px; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
        .btn-primary:hover { box-shadow: var(--shadow-lg); transform: translateY(-1px); }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        .btn-success { background: var(--success); color: white; }
        
        .filter-row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 24px; }
        .filter-pill { padding: 10px 18px; border: 1px solid var(--border); border-radius: 50px; background: var(--bg-card); color: var(--text-secondary); font-family: inherit; font-size: 13px; font-weight: 500; cursor: pointer; }
        .filter-pill:hover { border-color: var(--primary); color: var(--primary); }
        .filter-pill.active { background: var(--primary-bg); border-color: var(--primary); color: var(--primary); }
        
        .stats-row { display: flex; gap: 24px; margin-bottom: 20px; font-size: 14px; color: var(--text-secondary); }
        .stats-row strong { color: var(--primary); }
        
        .market-grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); }
        
        .market-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; cursor: pointer; position: relative; transition: transform 0.2s, box-shadow 0.2s; }
        .market-card:hover { border-color: var(--primary); box-shadow: var(--shadow-lg); transform: translateY(-2px); }
        .market-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--border); }
        .market-card.legendary::before { background: var(--success); }
        .market-card.epic::before { background: var(--info); }
        .market-card.rare::before { background: var(--warning); }
        .market-card.skip::before { background: var(--error); }
        
        .hot-badge { position: absolute; top: 12px; right: 12px; padding: 4px 10px; background: var(--error); color: white; font-size: 11px; font-weight: 600; border-radius: 6px; }
        .card-body { padding: 20px; }
        .card-category { font-size: 12px; font-weight: 500; color: var(--primary); margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .trend-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 8px; border-radius: 6px; font-size: 11px; font-weight: 500; }
        .trend-badge.up { background: var(--success-bg); color: var(--success); }
        .trend-badge.down { background: var(--error-bg); color: var(--error); }
        
        .signal-badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; margin-left: auto; }
        .signal-badge.strong { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .signal-badge.buy { background: var(--success-bg); color: var(--success); }
        .signal-badge.hold { background: var(--warning-bg); color: var(--warning); }
        .signal-badge.avoid { background: var(--error-bg); color: var(--error); }
        
        .signal-score { display: flex; align-items: center; gap: 2px; }
        .signal-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--border); }
        .signal-dot.active { background: var(--success); }
        .signal-dot.warn { background: var(--warning); }
        .signal-dot.bad { background: var(--error); }
        
        .signal-reasons { font-size: 11px; color: var(--text-muted); margin-top: 4px; display: flex; flex-wrap: wrap; gap: 4px; }
        .signal-reason { padding: 2px 6px; background: var(--bg); border-radius: 4px; }
        .signal-reason.positive { color: var(--success); }
        .signal-reason.negative { color: var(--error); }
        .card-title { font-size: 15px; font-weight: 600; color: var(--text); margin-bottom: 8px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .card-meta { display: flex; gap: 16px; font-size: 12px; color: var(--text-muted); }
        .card-meta-item { display: flex; align-items: center; gap: 4px; }
        
        .sparkline-container { padding: 12px 20px; background: var(--bg); border-top: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .sparkline-label { font-size: 11px; color: var(--text-muted); }
        .sparkline { flex: 1; height: 30px; margin: 0 12px; }
        .sparkline svg { width: 100%; height: 100%; }
        .sparkline-change { font-size: 12px; font-weight: 600; }
        .sparkline-change.up { color: var(--success); }
        .sparkline-change.down { color: var(--error); }
        
        .card-stats { display: grid; grid-template-columns: repeat(5, 1fr); border-top: 1px solid var(--border); }
        .stat-box { text-align: center; padding: 12px 6px; border-right: 1px solid var(--border); }
        .stat-box:last-child { border-right: none; }
        .stat-label { font-size: 10px; font-weight: 500; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px; }
        .stat-value { font-size: 15px; font-weight: 700; color: var(--text); }
        .stat-value.positive { color: var(--success); }
        .stat-value.negative { color: var(--error); }
        
        .card-footer { padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid var(--border); }
        .card-input-group { display: flex; align-items: center; gap: 8px; }
        .card-input-group label { font-size: 13px; color: var(--text-secondary); font-weight: 500; }
        .card-input-group .input-field { width: 60px; padding: 8px 10px; font-size: 14px; }
        .card-input-group .btn { padding: 8px 14px; }
        .card-trade-btn { padding: 8px 14px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: inherit; font-size: 13px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 6px; text-decoration: none; }
        .card-trade-btn:hover { background: var(--primary); border-color: var(--primary); color: white; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 1000; display: none; justify-content: center; align-items: center; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-card); border-radius: 20px; max-width: 600px; width: 100%; max-height: 85vh; overflow-y: auto; box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); animation: modalIn 0.2s ease; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: flex-start; position: sticky; top: 0; background: var(--bg-card); z-index: 10; }
        .modal-header h2 { font-size: 16px; font-weight: 600; color: var(--text); margin-bottom: 4px; line-height: 1.4; }
        .modal-header .category { font-size: 13px; color: var(--primary); font-weight: 500; }
        .modal-close { width: 32px; height: 32px; border-radius: 8px; border: none; background: var(--bg); color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .modal-close:hover { background: var(--error-bg); color: var(--error); }
        .modal-body { padding: 20px 24px; }
        .modal-section { margin-bottom: 20px; }
        .modal-section:last-child { margin-bottom: 0; }
        .modal-section h3 { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .modal-section p, .modal-section li { font-size: 14px; color: var(--text-secondary); line-height: 1.6; }
        .modal-section ul { padding-left: 20px; }
        .modal-section li { margin-bottom: 4px; }
        
        .calc-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .calc-card { background: var(--bg); border-radius: 12px; padding: 14px; border: 1px solid var(--border); }
        .calc-card h4 { font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 10px; }
        .calc-row { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px dashed var(--border); }
        .calc-row:last-child { border-bottom: none; }
        .calc-label { font-size: 12px; color: var(--text-secondary); }
        .calc-value { font-size: 13px; font-weight: 600; color: var(--text); }
        .calc-value.positive { color: var(--success); }
        .calc-value.negative { color: var(--error); }
        
        .recommend-box { background: var(--primary-bg); border-radius: 12px; padding: 16px; border: 1px solid var(--primary); }
        .recommend-box h4 { font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 12px; }
        .recommend-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(99, 102, 241, 0.2); }
        .recommend-item:last-child { border-bottom: none; }
        .recommend-label { font-size: 13px; color: var(--text-secondary); }
        .recommend-value { font-size: 14px; font-weight: 700; color: var(--primary); }
        .quick-bet-row { display: flex; gap: 8px; margin-top: 12px; }
        .quick-bet-btn { flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-card); color: var(--text); font-family: inherit; font-size: 13px; font-weight: 500; cursor: pointer; }
        .quick-bet-btn:hover { background: var(--primary); border-color: var(--primary); color: white; }
        
        .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; gap: 12px; position: sticky; bottom: 0; background: var(--bg-card); }
        .modal-footer .btn { flex: 1; justify-content: center; }
        
        .strategy-tags { display: flex; gap: 6px; flex-wrap: wrap; }
        .strategy-tag { padding: 6px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; font-size: 12px; color: var(--text-secondary); }
        
        .loading-state, .empty-state { text-align: center; padding: 60px 20px; grid-column: 1 / -1; }
        .loading-icon { font-size: 48px; margin-bottom: 16px; }
        
        .guide-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; margin-bottom: 16px; overflow: hidden; }
        .guide-card.highlight { border-color: var(--primary); }
        .guide-header { padding: 16px 20px; background: var(--bg); border-bottom: 1px solid var(--border); font-size: 15px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .guide-body { padding: 20px; }
        .guide-body p { font-size: 14px; color: var(--text-secondary); line-height: 1.8; margin-bottom: 8px; }
        .guide-body strong { color: var(--text); }
        
        .portfolio-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .portfolio-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; }
        .portfolio-card .label { font-size: 12px; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; }
        .portfolio-card .value { font-size: 28px; font-weight: 700; color: var(--text); }
        .portfolio-card .value.positive { color: var(--success); }
        .portfolio-card .value.negative { color: var(--error); }
        .portfolio-card .sub { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
        .progress-bar { height: 6px; background: var(--bg); border-radius: 3px; margin-top: 12px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--error), var(--warning), var(--success)); border-radius: 3px; }
        
        .form-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 24px; }
        .form-card h3 { font-size: 15px; font-weight: 600; margin-bottom: 16px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 12px; }
        .form-group label { display: block; font-size: 11px; font-weight: 500; color: var(--text-secondary); margin-bottom: 4px; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-family: inherit; font-size: 13px; }
        
        .table-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th { padding: 12px 16px; text-align: left; font-size: 11px; font-weight: 600; color: var(--text-secondary); background: var(--bg); text-transform: uppercase; }
        td { padding: 12px 16px; font-size: 13px; border-top: 1px solid var(--border); }
        .win { color: var(--success); }
        .loss { color: var(--error); }
        
        @media (max-width: 768px) {
            .market-grid { grid-template-columns: 1fr; }
            .calc-grid { grid-template-columns: 1fr; }
            .card-stats { grid-template-columns: repeat(3, 1fr); }
            .stat-box:nth-child(3) { border-right: none; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon"><span class="material-icons-round">show_chart</span></div>
            <span class="logo-text">PolyTrader Pro</span>
        </div>
        <div class="header-actions">
            <div class="status-pill" id="statusPill">
                <div class="status-dot"></div>
                <span id="statusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span>
            </div>
            <button class="icon-btn" onclick="toggleTheme()" title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°">
                <span class="material-icons-round" id="themeIcon">dark_mode</span>
            </button>
        </div>
    </header>
    
    <main class="main">
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('scanner')"><span class="material-icons-round">search</span>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏•‡∏≤‡∏î</button>
            <button class="tab-btn" onclick="showTab('portfolio')"><span class="material-icons-round">account_balance_wallet</span>‡∏û‡∏≠‡∏£‡πå‡∏ï</button>
            <button class="tab-btn" onclick="showTab('guide')"><span class="material-icons-round">help_outline</span>‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠</button>
        </div>
        
        <div class="tab-content active" id="tab-scanner">
            <div class="controls-card">
                <div class="controls-row">
                    <div class="control-group"><label>‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏ô ($)</label><input type="number" class="input-field" id="bankroll" value="100"></div>
                    <div class="control-group"><label>‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á ($)</label><input type="number" class="input-field" id="betAmount" value="10"></div>
                    <div class="control-group"><label>Edge ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (%)</label><input type="number" class="input-field" id="minEdge" value="5"></div>
                    <div class="control-group search-field"><label>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏•‡∏≤‡∏î</label><input type="text" class="input-field" id="searchInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î..." oninput="filterMarkets()"></div>
                    <button class="btn btn-primary" onclick="fetchMarkets()"><span class="material-icons-round">refresh</span>‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà</button>
                </div>
            </div>
            
            <div class="filter-row">
                <button class="filter-pill active" onclick="filterCategory('all', this)">üåê ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="filter-pill" onclick="filterCategory('crypto', this)">‚Çø ‡∏Ñ‡∏£‡∏¥‡∏õ‡πÇ‡∏ï</button>
                <button class="filter-pill" onclick="filterCategory('politics', this)">üèõÔ∏è ‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á</button>
                <button class="filter-pill" onclick="filterCategory('sports', this)">‚öΩ ‡∏Å‡∏µ‡∏¨‡∏≤</button>
                <button class="filter-pill" onclick="filterCategory('entertainment', this)">üé¨ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</button>
                <button class="filter-pill" onclick="filterCategory('science', this)">üî¨ AI/‡∏ß‡∏¥‡∏ó‡∏¢‡πå</button>
                <button class="filter-pill" onclick="filterCategory('business', this)">üíº ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</button>
            </div>
            
            <div class="filter-row" style="margin-top: -12px;">
                <span style="font-size: 13px; color: var(--text-secondary); margin-right: 8px;">üéØ Signal:</span>
                <button class="filter-pill signal-filter active" onclick="filterSignal('all', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="filter-pill signal-filter" onclick="filterSignal('strong', this)">üî• Strong Buy</button>
                <button class="filter-pill signal-filter" onclick="filterSignal('buy', this)">‚úÖ Buy</button>
                <button class="filter-pill signal-filter" onclick="filterSignal('hold', this)">‚è∏Ô∏è Hold</button>
                <button class="filter-pill signal-filter" onclick="filterSignal('avoid', this)">‚ö†Ô∏è Avoid</button>
            </div>
            
            <div class="stats-row">
                <div>‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong id="totalMarkets">0</strong></div>
                <div>‡πÅ‡∏™‡∏î‡∏á: <strong id="filteredMarkets">0</strong></div>
                <div>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: <strong id="lastUpdate">--:--</strong></div>
            </div>
            
            <div class="market-grid" id="marketGrid"><div class="loading-state"><div class="loading-icon">üìä</div><div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div></div>
        </div>
        
        <div class="tab-content" id="tab-portfolio">
            <div class="portfolio-grid">
                <div class="portfolio-card"><div class="label">üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div><div class="value" id="pBankroll">$100</div><div class="progress-bar"><div class="progress-fill" id="hpFill" style="width: 100%;"></div></div></div>
                <div class="portfolio-card"><div class="label">üìà ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</div><div class="value positive" id="pPnL">+$0</div><div class="sub" id="pPnLPct">0%</div></div>
                <div class="portfolio-card"><div class="label">üéØ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ä‡∏ô‡∏∞</div><div class="value" id="pWinRate">0%</div><div class="sub" id="pWinLoss">‡∏ä‡∏ô‡∏∞ 0 - ‡πÅ‡∏û‡πâ 0</div></div>
            </div>
            <div class="form-card">
                <h3>‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</h3>
                <div class="form-row">
                    <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î</label><input type="text" id="betEvent" placeholder="BITCOIN >100K"></div>
                    <div class="form-group"><label>‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏á ($)</label><input type="number" id="betStake" placeholder="10"></div>
                    <div class="form-group"><label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠ (¬¢)</label><input type="number" id="betPrice" placeholder="55"></div>
                    <div class="form-group"><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label><select id="betStatus"><option value="pending">‚è≥ ‡∏£‡∏≠</option><option value="win">‚úÖ ‡∏ä‡∏ô‡∏∞</option><option value="loss">‚ùå ‡πÅ‡∏û‡πâ</option></select></div>
                </div>
                <button class="btn btn-primary" onclick="addBet()"><span class="material-icons-round">add</span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
            <div class="table-container"><table><thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ï‡∏•‡∏≤‡∏î</th><th>‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏á</th><th>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th></th></tr></thead><tbody id="betsTable"><tr><td colspan="6" style="text-align:center;color:var(--text-muted);">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td></tr></tbody></table></div>
        </div>
        
        <div class="tab-content" id="tab-guide">
            <div class="guide-card highlight"><div class="guide-header"><span class="material-icons-round">lightbulb</span>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div><div class="guide-body"><p><strong>1.</strong> ‡∏î‡∏π Signal Rating ‚Üí ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>üî• Strong Buy</strong> ‡∏´‡∏£‡∏∑‡∏≠ <strong>‚úÖ Buy</strong></p><p><strong>2.</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î ‚Üí ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Ç‡∏≠‡∏á Signal</p><p><strong>3.</strong> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Model% ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÄ‡∏≠‡∏á‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p><p><strong>4.</strong> ‡∏î‡∏π‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Å‡∏µ‡πà shares ‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà</p></div></div>
            
            <div class="guide-card"><div class="guide-header"><span class="material-icons-round">analytics</span>üéØ Signal Rating ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?</div><div class="guide-body">
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å 6 ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢:</p>
                <p><strong>1. Volume (0-25 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</strong> - ‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏ó‡∏£‡∏î‡πÄ‡∏¢‡∏≠‡∏∞ = ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠</p>
                <p><strong>2. Edge (0-25 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</strong> - ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Model% ‡∏Å‡∏±‡∏ö Implied%</p>
                <p><strong>3. Price Range (0-20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</strong> - ‡∏£‡∏≤‡∏Ñ‡∏≤ 20-80¬¢ ‡∏°‡∏µ liquidity ‡∏î‡∏µ</p>
                <p><strong>4. EV (0-20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</strong> - Expected Value ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á</p>
                <p><strong>5. Risk/Reward (0-10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</strong> - ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</p>
                <p><strong>6. Time Factor</strong> - ‡∏ï‡∏•‡∏≤‡∏î‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≤‡∏à‡∏°‡∏µ inefficiency</p>
            </div></div>
            
            <div class="guide-card"><div class="guide-header"><span class="material-icons-round">star</span>Signal Levels</div><div class="guide-body">
                <p><strong>üî• Strong Buy (70+ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</strong> - ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏ó‡∏£‡∏î</p>
                <p><strong>‚úÖ Buy (50-69 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</strong> - ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏î‡∏µ ‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à</p>
                <p><strong>‚è∏Ô∏è Hold (30-49 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</strong> - ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏£‡∏≠‡∏î‡∏π‡∏Å‡πà‡∏≠‡∏ô</p>
                <p><strong>‚ö†Ô∏è Avoid (0-29 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</strong> - ‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ risk ‡∏™‡∏π‡∏á</p>
            </div></div>
            
            <div class="guide-card"><div class="guide-header"><span class="material-icons-round">calculate</span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</div><div class="guide-body"><p><strong>‡∏£‡∏≤‡∏Ñ‡∏≤</strong> = ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô 35¬¢ = ‡∏à‡πà‡∏≤‡∏¢ 35 ‡πÄ‡∏ã‡∏ô‡∏ï‡πå ‡∏ñ‡πâ‡∏≤‡∏ä‡∏ô‡∏∞‡πÑ‡∏î‡πâ $1</p><p><strong>IMPLIED</strong> = ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏ï‡∏•‡∏≤‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</p><p><strong>MODEL*</strong> = ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏µ‡πà AI ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</p><p><strong>EDGE</strong> = ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á ‡∏ñ‡πâ‡∏≤‡∏ö‡∏ß‡∏Å = ‡∏ô‡πà‡∏≤‡∏ã‡∏∑‡πâ‡∏≠</p><p><strong>EV</strong> = ‡∏Å‡∏≥‡πÑ‡∏£‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏ï‡πà‡∏≠ $100</p></div></div>
            
            <div class="guide-card"><div class="guide-header"><span class="material-icons-round">warning</span>‡∏Å‡∏é‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</div><div class="guide-body"><p>‚ö†Ô∏è <strong>‡∏Å‡∏é 5%</strong> - ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5% ‡∏ï‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î</p><p>üõë <strong>‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô 20%</strong></p><p>‚ùå <strong>‡∏´‡πâ‡∏≤‡∏°‡πÑ‡∏•‡πà‡∏ï‡∏≤‡∏°‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</strong></p><p>üéØ <strong>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Strong Buy / Buy</strong> ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p></div></div>
        </div>
    </main>
    
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div><h2 id="modalTitle">‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î</h2><div class="category" id="modalCategory">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</div></div>
                <button class="modal-close" onclick="closeModalBtn()"><span class="material-icons-round">close</span></button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModalBtn()">‡∏õ‡∏¥‡∏î</button>
                <a id="modalTradeBtn" href="#" target="_blank" class="btn btn-primary"><span class="material-icons-round">launch</span>‡πÑ‡∏õ‡πÄ‡∏ó‡∏£‡∏î</a>
            </div>
        </div>
    </div>
    
    <script>
        const API_URL = '/api/polymarket';
        let allMarkets = [], filteredMarketsCache = [], currentCategory = 'all', currentSignal = 'all';
        let bets = JSON.parse(localStorage.getItem('polytrader_bets') || '[]');
        let isDark = localStorage.getItem('theme') === 'dark';
        
        if (isDark) { document.body.setAttribute('data-theme', 'dark'); document.getElementById('themeIcon').textContent = 'light_mode'; }
        
        function toggleTheme() {
            isDark = !isDark;
            document.body.setAttribute('data-theme', isDark ? 'dark' : '');
            document.getElementById('themeIcon').textContent = isDark ? 'light_mode' : 'dark_mode';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }
        
        // Signal Rating System - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à
        function calculateSignal(market) {
            let score = 0;
            let reasons = [];
            
            const price = market.price;
            const volume = market.volume;
            const impl = price * 100;
            const vol = Math.min(15, Math.max(5, (1 - price) * price * 100));
            const model = Math.round(Math.min(95, Math.max(5, impl + vol * 0.5)));
            const edge = model - impl;
            const ev = ((model / 100) * (100 * (1/price - 1))) - ((1 - model / 100) * 100);
            
            // 1. Volume Score (0-25) - ‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏ó‡∏£‡∏î‡πÄ‡∏¢‡∏≠‡∏∞ = ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠
            if (volume >= 10000000) { score += 25; reasons.push({ text: 'Volume ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å', positive: true }); }
            else if (volume >= 1000000) { score += 20; reasons.push({ text: 'Volume ‡∏î‡∏µ', positive: true }); }
            else if (volume >= 100000) { score += 10; reasons.push({ text: 'Volume ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', positive: true }); }
            else { score += 0; reasons.push({ text: 'Volume ‡∏ï‡πà‡∏≥', positive: false }); }
            
            // 2. Edge Score (0-25) - ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Model ‡∏Å‡∏±‡∏ö Implied
            if (edge >= 15) { score += 25; reasons.push({ text: 'Edge ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å +' + edge.toFixed(0) + '%', positive: true }); }
            else if (edge >= 10) { score += 20; reasons.push({ text: 'Edge ‡∏î‡∏µ +' + edge.toFixed(0) + '%', positive: true }); }
            else if (edge >= 5) { score += 15; reasons.push({ text: 'Edge ‡∏û‡∏≠‡πÉ‡∏ä‡πâ +' + edge.toFixed(0) + '%', positive: true }); }
            else if (edge >= 0) { score += 5; reasons.push({ text: 'Edge ‡∏ô‡πâ‡∏≠‡∏¢', positive: false }); }
            else { score -= 10; reasons.push({ text: 'Edge ‡∏ï‡∏¥‡∏î‡∏•‡∏ö', positive: false }); }
            
            // 3. Price Range Score (0-20) - ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡πÜ ‡∏°‡∏µ liquidity ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
            if (price >= 0.20 && price <= 0.80) { score += 20; reasons.push({ text: '‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°', positive: true }); }
            else if (price >= 0.10 && price <= 0.90) { score += 10; reasons.push({ text: '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏≠‡πÑ‡∏î‡πâ', positive: true }); }
            else if (price < 0.05 || price > 0.95) { score -= 5; reasons.push({ text: '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏±‡πâ‡∏ß', positive: false }); }
            
            // 4. EV Score (0-20) - Expected Value
            if (ev >= 50) { score += 20; reasons.push({ text: 'EV ‡∏™‡∏π‡∏á +$' + ev.toFixed(0), positive: true }); }
            else if (ev >= 20) { score += 15; reasons.push({ text: 'EV ‡∏î‡∏µ +$' + ev.toFixed(0), positive: true }); }
            else if (ev >= 0) { score += 5; }
            else { score -= 5; reasons.push({ text: 'EV ‡∏ï‡∏¥‡∏î‡∏•‡∏ö', positive: false }); }
            
            // 5. Risk/Reward Score (0-10)
            const rr = (1/price - 1);
            if (rr >= 5) { score += 10; reasons.push({ text: 'R/R 1:' + rr.toFixed(1), positive: true }); }
            else if (rr >= 2) { score += 5; }
            else if (rr < 0.5) { score -= 5; reasons.push({ text: 'R/R ‡∏ï‡πà‡∏≥', positive: false }); }
            
            // 6. Time Factor - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ endDate
            if (market.endDate) {
                const daysLeft = Math.ceil((new Date(market.endDate) - new Date()) / (1000 * 60 * 60 * 24));
                if (daysLeft <= 7 && daysLeft > 0) { score += 5; reasons.push({ text: '‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î ' + daysLeft + ' ‡∏ß‡∏±‡∏ô', positive: true }); }
                else if (daysLeft <= 0) { score -= 20; reasons.push({ text: '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß', positive: false }); }
            }
            
            // Determine signal level
            let signal, signalText, signalClass;
            if (score >= 70) { signal = 'strong'; signalText = 'üî• Strong Buy'; signalClass = 'strong'; }
            else if (score >= 50) { signal = 'buy'; signalText = '‚úÖ Buy'; signalClass = 'buy'; }
            else if (score >= 30) { signal = 'hold'; signalText = '‚è∏Ô∏è Hold'; signalClass = 'hold'; }
            else { signal = 'avoid'; signalText = '‚ö†Ô∏è Avoid'; signalClass = 'avoid'; }
            
            return { score, signal, signalText, signalClass, reasons, edge, ev, model };
        }
        
        const categoryKeywords = {
            crypto: ['bitcoin', 'btc', 'ethereum', 'eth', 'crypto', 'solana', 'xrp', 'doge'],
            politics: ['trump', 'biden', 'election', 'president', 'putin', 'ukraine', 'russia', 'china', 'maduro', 'khamenei', 'ceasefire'],
            sports: ['nba', 'nfl', 'nhl', 'mlb', 'soccer', 'football', 'basketball', 'ufc'],
            entertainment: ['movie', 'oscar', 'grammy', 'actor', 'film', 'netflix', 'grossing'],
            science: ['ai', 'openai', 'chatgpt', 'tesla', 'spacex', 'mars', 'nasa'],
            business: ['ipo', 'stock', 'ceo', 'fed', 'inflation', 'recession', 'economy', 'largest company']
        };
        
        const strategies = {
            crypto: { icon: '‚Çø', name: '‡∏Ñ‡∏£‡∏¥‡∏õ‡πÇ‡∏ï', howTo: ['‡∏î‡∏π Technical Analysis ‡∏ö‡∏ô TradingView', '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Crypto Twitter'], tips: ['Bitcoin ‡∏°‡∏±‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á Halving'], sources: 'TradingView, CoinGecko' },
            politics: { icon: 'üèõÔ∏è', name: '‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á', howTo: ['‡∏î‡∏π Polls ‡∏à‡∏≤‡∏Å FiveThirtyEight', '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡πà‡∏≤‡∏ß Reuters'], tips: ['Polls ‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô 3-5%'], sources: 'FiveThirtyEight, Reuters' },
            sports: { icon: '‚öΩ', name: '‡∏Å‡∏µ‡∏¨‡∏≤', howTo: ['‡∏î‡∏π Odds ‡∏à‡∏≤‡∏Å FanDuel', '‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡πà‡∏≤‡∏ß‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö'], tips: ['Odds -150 = 60%'], sources: 'FanDuel, ESPN' },
            entertainment: { icon: 'üé¨', name: '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á', howTo: ['‡∏î‡∏π Critics reviews', '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Awards prediction'], tips: ['Oscar ‡∏°‡∏µ narrative ‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö'], sources: 'Rotten Tomatoes' },
            science: { icon: 'üî¨', name: 'AI/‡∏ß‡∏¥‡∏ó‡∏¢‡πå', howTo: ['‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° The Verge, TechCrunch'], tips: ['Tech ‡∏°‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤'], sources: 'The Verge' },
            business: { icon: 'üíº', name: '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', howTo: ['‡∏î‡∏π Bloomberg reports', '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Fed'], tips: ['Fed ‡∏ö‡∏≠‡∏Å guidance ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤'], sources: 'Bloomberg, CNBC' },
            other: { icon: 'üìä', name: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ', howTo: ['‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏•‡∏≤‡∏î'], tips: ['‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏ó‡∏£‡∏î'], sources: 'Google News' }
        };
        
        const catNames = { crypto: '‡∏Ñ‡∏£‡∏¥‡∏õ‡πÇ‡∏ï', politics: '‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á', sports: '‡∏Å‡∏µ‡∏¨‡∏≤', entertainment: '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á', science: 'AI/‡∏ß‡∏¥‡∏ó‡∏¢‡πå', business: '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', other: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' };
        
        function detectCategory(title, slug) {
            const text = (title + ' ' + slug).toLowerCase();
            for (const [cat, kws] of Object.entries(categoryKeywords)) {
                if (kws.some(kw => text.includes(kw))) return cat;
            }
            return 'other';
        }
        
        function showTab(name) {
            document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.closest('.tab-btn').classList.add('active');
            document.getElementById(`tab-${name}`).classList.add('active');
            if (name === 'portfolio') updatePortfolio();
        }
        
        function generateSparkline(isUp) {
            const pts = [];
            let y = 15 + Math.random() * 10;
            for (let i = 0; i <= 8; i++) {
                y = Math.max(5, Math.min(25, y + (Math.random() * 8 - 4)));
                pts.push(`${i * 12.5},${y}`);
            }
            return `<svg viewBox="0 0 100 30" preserveAspectRatio="none"><polyline fill="none" stroke="${isUp ? '#10b981' : '#ef4444'}" stroke-width="2" points="${pts.join(' ')}"/></svg>`;
        }
        
        function openModal(i) {
            const m = filteredMarketsCache[i];
            if (!m) return;
            
            const s = strategies[m.category] || strategies.other;
            const bet = parseFloat(document.getElementById('betAmount').value) || 10;
            const bank = parseFloat(document.getElementById('bankroll').value) || 100;
            const p = m.price, pNo = 1 - p, impl = p * 100;
            
            // Use signal calculation
            const sig = calculateSignal(m);
            
            const sharesY = bet / p, profitY = sharesY - bet;
            const sharesN = bet / pNo, profitN = sharesN - bet;
            const kelly = Math.max(0, Math.min(5, (sig.edge/100) * 100 / (1/p - 1)));
            const kellyAmt = bank * kelly / 100;
            const recShares = Math.floor(kellyAmt / p);
            const target = Math.min(0.90, p + 0.10);
            const sellProf = ((target - p) / p * 100).toFixed(0);
            
            // Generate reasons HTML
            const reasonsHtml = sig.reasons.map(r => 
                `<span class="signal-reason ${r.positive ? 'positive' : 'negative'}">${r.positive ? '‚úì' : '‚úó'} ${r.text}</span>`
            ).join('');
            
            document.getElementById('modalTitle').textContent = m.title;
            document.getElementById('modalCategory').innerHTML = `${s.icon} ${catNames[m.category] || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'}`;
            document.getElementById('modalTradeBtn').href = m.url;
            
            document.getElementById('modalBody').innerHTML = `
                <div class="modal-section">
                    <h3>üéØ Signal Analysis</h3>
                    <div class="recommend-box" style="margin-bottom: 0; background: ${sig.signal === 'strong' ? 'linear-gradient(135deg, rgba(16,185,129,0.15), rgba(5,150,105,0.15))' : sig.signal === 'buy' ? 'var(--success-bg)' : sig.signal === 'hold' ? 'var(--warning-bg)' : 'var(--error-bg)'}; border-color: ${sig.signal === 'strong' || sig.signal === 'buy' ? 'var(--success)' : sig.signal === 'hold' ? 'var(--warning)' : 'var(--error)'};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <span style="font-size: 24px; font-weight: 700;">${sig.signalText}</span>
                            <span style="font-size: 18px; font-weight: 600; color: var(--text);">Score: ${sig.score}/100</span>
                        </div>
                        <div class="signal-reasons">${reasonsHtml}</div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>ü§ñ Model% ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
                    <div class="recommend-box" style="margin-bottom: 0;">
                        <div class="recommend-item"><span class="recommend-label">‡∏ï‡∏•‡∏≤‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</span><span class="recommend-value">${impl.toFixed(1)}%</span></div>
                        <div class="recommend-item"><span class="recommend-label">ü§ñ AI ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span><span class="recommend-value" style="font-size: 18px;">${sig.model}%</span></div>
                        <div class="recommend-item"><span class="recommend-label">Edge</span><span class="recommend-value" style="color: ${sig.edge >= 5 ? 'var(--success)' : 'var(--text)'};">${sig.edge >= 0 ? '+' : ''}${sig.edge.toFixed(0)}%</span></div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>üí∞ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£ (‡∏•‡∏á $${bet})</h3>
                    <div class="calc-grid">
                        <div class="calc-card"><h4>üü¢ ‡∏ã‡∏∑‡πâ‡∏≠ YES ${(p*100).toFixed(0)}¬¢</h4>
                            <div class="calc-row"><span class="calc-label">‡πÑ‡∏î‡πâ shares</span><span class="calc-value">${sharesY.toFixed(1)}</span></div>
                            <div class="calc-row"><span class="calc-label">‡∏ñ‡πâ‡∏≤‡∏ä‡∏ô‡∏∞</span><span class="calc-value positive">+$${profitY.toFixed(2)}</span></div>
                            <div class="calc-row"><span class="calc-label">‡∏ñ‡πâ‡∏≤‡πÅ‡∏û‡πâ</span><span class="calc-value negative">-$${bet}</span></div>
                        </div>
                        <div class="calc-card"><h4>üî¥ ‡∏ã‡∏∑‡πâ‡∏≠ NO ${(pNo*100).toFixed(0)}¬¢</h4>
                            <div class="calc-row"><span class="calc-label">‡πÑ‡∏î‡πâ shares</span><span class="calc-value">${sharesN.toFixed(1)}</span></div>
                            <div class="calc-row"><span class="calc-label">‡∏ñ‡πâ‡∏≤‡∏ä‡∏ô‡∏∞</span><span class="calc-value positive">+$${profitN.toFixed(2)}</span></div>
                            <div class="calc-row"><span class="calc-label">‡∏ñ‡πâ‡∏≤‡πÅ‡∏û‡πâ</span><span class="calc-value negative">-$${bet}</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <div class="recommend-box">
                        <h4>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (Bankroll $${bank})</h4>
                        <div class="recommend-item"><span class="recommend-label">‡∏Ñ‡∏ß‡∏£‡∏ã‡∏∑‡πâ‡∏≠ YES</span><span class="recommend-value">${recShares} ‡∏´‡∏∏‡πâ‡∏ô (~$${(recShares * p).toFixed(2)})</span></div>
                        <div class="recommend-item"><span class="recommend-label">Kelly %</span><span class="recommend-value">${kelly.toFixed(1)}% = $${kellyAmt.toFixed(2)}</span></div>
                        <div class="recommend-item"><span class="recommend-label">‡∏Ç‡∏≤‡∏¢‡∏ó‡∏≥‡∏Å‡∏≥‡πÑ‡∏£‡∏ó‡∏µ‡πà</span><span class="recommend-value">${(target*100).toFixed(0)}¬¢ (+${sellProf}%)</span></div>
                        <div class="recommend-item"><span class="recommend-label">Risk/Reward</span><span class="recommend-value">1:${(profitY/bet).toFixed(1)}</span></div>
                        <div class="quick-bet-row">
                            <button class="quick-bet-btn" onclick="updateBet(5, ${i})">$5</button>
                            <button class="quick-bet-btn" onclick="updateBet(10, ${i})">$10</button>
                            <button class="quick-bet-btn" onclick="updateBet(25, ${i})">$25</button>
                            <button class="quick-bet-btn" onclick="updateBet(50, ${i})">$50</button>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section"><h3>üéØ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤ Model%</h3><ul>${s.howTo.map(h => `<li>${h}</li>`).join('')}</ul></div>
                <div class="modal-section"><h3>üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö</h3><ul>${s.tips.map(t => `<li>${t}</li>`).join('')}</ul></div>
                <div class="modal-section"><h3>üìö ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3><div class="strategy-tags">${s.sources.split(', ').map(src => `<span class="strategy-tag">${src}</span>`).join('')}</div></div>
            `;
            
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function updateBet(amt, i) { document.getElementById('betAmount').value = amt; openModal(i); }
        function closeModal(e) { if (e.target.id === 'modalOverlay') closeModalBtn(); }
        function closeModalBtn() { document.getElementById('modalOverlay').classList.remove('active'); document.body.style.overflow = ''; }
        
        async function fetchMarkets() {
            const grid = document.getElementById('marketGrid');
            const pill = document.getElementById('statusPill');
            const text = document.getElementById('statusText');
            
            grid.innerHTML = '<div class="loading-state"><div class="loading-icon">üìä</div><div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>';
            pill.classList.remove('offline');
            text.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
            
            try {
                const res = await fetch(`${API_URL}?endpoint=events&closed=false&limit=200`);
                if (!res.ok) throw new Error(`Error ${res.status}`);
                const events = await res.json();
                
                allMarkets = events.map(e => {
                    const m = e.markets?.[0] || {};
                    let price = 0;
                    if (m.outcomePrices) { try { price = parseFloat(JSON.parse(m.outcomePrices)[0]) || 0; } catch {} }
                    return { id: e.id, title: e.title || 'Unknown', slug: e.slug || '', endDate: e.endDate, category: detectCategory(e.title || '', e.slug || ''), price, volume: parseFloat(m.volume) || 0, url: `https://polymarket.com/event/${e.slug}` };
                }).filter(m => m.price > 0.01 && m.price < 0.99);
                
                allMarkets.sort((a, b) => b.volume - a.volume);
                text.textContent = `‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ¬∑ ${allMarkets.length} ‡∏ï‡∏•‡∏≤‡∏î`;
                document.getElementById('totalMarkets').textContent = allMarkets.length;
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'});
                filterMarkets();
            } catch (err) {
                pill.classList.add('offline');
                text.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
                grid.innerHTML = `<div class="empty-state"><div class="loading-icon">‚ùå</div><div>‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div><button class="btn btn-primary" onclick="fetchMarkets()" style="margin-top:16px;">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button></div>`;
            }
        }
        
        function filterCategory(cat, btn) {
            currentCategory = cat;
            document.querySelectorAll('.filter-pill:not(.signal-filter)').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            filterMarkets();
        }
        
        function filterSignal(sig, btn) {
            currentSignal = sig;
            document.querySelectorAll('.filter-pill.signal-filter').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            filterMarkets();
        }
        
        function filterMarkets() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            let filtered = allMarkets;
            if (currentCategory !== 'all') filtered = filtered.filter(m => m.category === currentCategory);
            if (search) filtered = filtered.filter(m => m.title.toLowerCase().includes(search));
            
            // Apply signal filter
            if (currentSignal !== 'all') {
                filtered = filtered.filter(m => {
                    const sig = calculateSignal(m);
                    return sig.signal === currentSignal;
                });
            }
            
            // Sort by signal score (best first)
            filtered.sort((a, b) => calculateSignal(b).score - calculateSignal(a).score);
            
            filteredMarketsCache = filtered;
            document.getElementById('filteredMarkets').textContent = filtered.length;
            renderMarkets(filtered);
        }
        
        function renderMarkets(markets) {
            const grid = document.getElementById('marketGrid');
            if (!markets.length) { grid.innerHTML = '<div class="empty-state"><div class="loading-icon">üîç</div><div>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏•‡∏≤‡∏î</div></div>'; return; }
            
            grid.innerHTML = markets.slice(0, 50).map((m, i) => {
                const date = m.endDate ? new Date(m.endDate).toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit' }) : '';
                const hot = m.volume > 1000000;
                const s = strategies[m.category] || strategies.other;
                const impl = m.price * 100;
                
                // Use signal calculation
                const sig = calculateSignal(m);
                const trend = (Math.random() * 6 - 2).toFixed(1);
                const isUp = parseFloat(trend) >= 0;
                const rarity = sig.edge >= 10 ? 'legendary' : sig.edge >= 5 ? 'epic' : sig.edge >= 0 ? 'rare' : 'skip';
                
                // Generate signal score dots
                const scoreDots = Array(5).fill(0).map((_, idx) => {
                    const threshold = (idx + 1) * 20;
                    if (sig.score >= threshold) return '<span class="signal-dot active"></span>';
                    else if (sig.score >= threshold - 10) return '<span class="signal-dot warn"></span>';
                    return '<span class="signal-dot"></span>';
                }).join('');
                
                return `<div class="market-card ${rarity}" onclick="openModal(${i})">
                    ${hot ? '<span class="hot-badge">Hot!</span>' : ''}
                    <div class="card-body">
                        <div class="card-category">
                            ${s.icon} ${catNames[m.category] || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'}
                            <span class="trend-badge ${isUp ? 'up' : 'down'}">${isUp ? '‚ñ≤' : '‚ñº'} ${Math.abs(trend)}%</span>
                            <span class="signal-badge ${sig.signalClass}">${sig.signalText}</span>
                        </div>
                        <h3 class="card-title">${m.title}</h3>
                        <div class="card-meta">
                            ${date ? `<span class="card-meta-item"><span class="material-icons-round" style="font-size:14px;">event</span>${date}</span>` : ''}
                            <span class="card-meta-item"><span class="material-icons-round" style="font-size:14px;">bar_chart</span>$${formatNum(m.volume)}</span>
                            <span class="card-meta-item"><span class="signal-score">${scoreDots}</span> ${sig.score}pt</span>
                        </div>
                    </div>
                    <div class="sparkline-container"><span class="sparkline-label">7 ‡∏ß‡∏±‡∏ô</span><div class="sparkline">${generateSparkline(isUp)}</div><span class="sparkline-change ${isUp ? 'up' : 'down'}">${isUp ? '+' : ''}${trend}%</span></div>
                    <div class="card-stats">
                        <div class="stat-box"><div class="stat-label">‡∏£‡∏≤‡∏Ñ‡∏≤</div><div class="stat-value">${(m.price*100).toFixed(0)}¬¢</div></div>
                        <div class="stat-box"><div class="stat-label">Implied</div><div class="stat-value">${impl.toFixed(1)}%</div></div>
                        <div class="stat-box"><div class="stat-label">Model*</div><div class="stat-value" style="color: var(--primary);">${sig.model}%</div></div>
                        <div class="stat-box"><div class="stat-label">Edge</div><div class="stat-value ${sig.edge >= 5 ? 'positive' : sig.edge >= 0 ? '' : 'negative'}">${sig.edge >= 0 ? '+' : ''}${sig.edge.toFixed(0)}%</div></div>
                        <div class="stat-box"><div class="stat-label">EV</div><div class="stat-value ${sig.ev >= 0 ? 'positive' : 'negative'}">${sig.ev >= 0 ? '+' : ''}$${sig.ev.toFixed(0)}</div></div>
                    </div>
                    <div class="card-footer">
                        <div class="card-input-group"><label>Model%</label><input type="number" class="input-field" id="input-${i}" value="${sig.model}" min="1" max="99" onclick="event.stopPropagation()"><button class="btn btn-success" onclick="event.stopPropagation(); calculate(${i}, ${m.price})">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button></div>
                        <a href="${m.url}" target="_blank" class="card-trade-btn" onclick="event.stopPropagation()"><span class="material-icons-round" style="font-size:16px;">launch</span>‡πÄ‡∏ó‡∏£‡∏î</a>
                    </div>
                </div>`;
            }).join('');
        }
        
        function calculate(i, price) {
            const model = parseFloat(document.getElementById(`input-${i}`).value);
            if (!model || model < 1 || model > 99) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Model% 1-99'); return; }
            const impl = price * 100, edge = model - impl, ev = ((model / 100) * (100 * (1/price - 1))) - ((1 - model / 100) * 100);
            const card = document.getElementById(`input-${i}`).closest('.market-card');
            const stats = card.querySelectorAll('.stat-box');
            stats[2].querySelector('.stat-value').textContent = `${model}%`;
            const edgeEl = stats[3].querySelector('.stat-value');
            edgeEl.textContent = `${edge >= 0 ? '+' : ''}${edge.toFixed(0)}%`;
            edgeEl.className = `stat-value ${edge >= 5 ? 'positive' : edge >= 0 ? '' : 'negative'}`;
            const evEl = stats[4].querySelector('.stat-value');
            evEl.textContent = `${ev >= 0 ? '+' : ''}$${ev.toFixed(0)}`;
            evEl.className = `stat-value ${ev >= 0 ? 'positive' : 'negative'}`;
            card.classList.remove('legendary', 'epic', 'rare', 'skip');
            card.classList.add(edge >= 10 ? 'legendary' : edge >= 5 ? 'epic' : edge >= 0 ? 'rare' : 'skip');
        }
        
        function addBet() {
            const event = document.getElementById('betEvent').value, stake = parseFloat(document.getElementById('betStake').value), price = parseFloat(document.getElementById('betPrice').value) / 100, status = document.getElementById('betStatus').value;
            if (!event || !stake || !price) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'); return; }
            const pnl = status === 'win' ? (stake / price) - stake : status === 'loss' ? -stake : 0;
            bets.unshift({ id: Date.now(), date: new Date().toISOString(), event, stake, price, status, pnl });
            localStorage.setItem('polytrader_bets', JSON.stringify(bets));
            document.getElementById('betEvent').value = ''; document.getElementById('betStake').value = ''; document.getElementById('betPrice').value = '';
            updatePortfolio();
        }
        
        function updateStatus(id, status) {
            const bet = bets.find(b => b.id === id);
            if (bet) { bet.status = status; bet.pnl = status === 'win' ? (bet.stake / bet.price) - bet.stake : status === 'loss' ? -bet.stake : 0; localStorage.setItem('polytrader_bets', JSON.stringify(bets)); updatePortfolio(); }
        }
        
        function deleteBet(id) { if (confirm('‡∏•‡∏ö?')) { bets = bets.filter(b => b.id !== id); localStorage.setItem('polytrader_bets', JSON.stringify(bets)); updatePortfolio(); } }
        
        function updatePortfolio() {
            const bank = parseFloat(document.getElementById('bankroll').value) || 100;
            const wins = bets.filter(b => b.status === 'win'), losses = bets.filter(b => b.status === 'loss');
            const pnl = bets.reduce((s, b) => s + b.pnl, 0), curr = bank + pnl;
            const wr = wins.length + losses.length > 0 ? (wins.length / (wins.length + losses.length) * 100).toFixed(0) : 0;
            document.getElementById('pBankroll').textContent = `$${curr.toFixed(0)}`;
            document.getElementById('pPnL').textContent = `${pnl >= 0 ? '+' : ''}$${pnl.toFixed(2)}`;
            document.getElementById('pPnL').className = `value ${pnl >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('pPnLPct').textContent = `${(pnl / bank * 100).toFixed(1)}%`;
            document.getElementById('pWinRate').textContent = `${wr}%`;
            document.getElementById('pWinLoss').textContent = `‡∏ä‡∏ô‡∏∞ ${wins.length} - ‡πÅ‡∏û‡πâ ${losses.length}`;
            document.getElementById('hpFill').style.width = `${Math.max(0, Math.min(100, (curr / bank) * 100))}%`;
            const tbody = document.getElementById('betsTable');
            if (!bets.length) { tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--text-muted);">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td></tr>'; return; }
            tbody.innerHTML = bets.map(b => `<tr><td>${new Date(b.date).toLocaleDateString('th-TH', { day: 'numeric', month: 'short' })}</td><td>${b.event}</td><td>$${b.stake}</td><td class="${b.status === 'win' ? 'win' : b.status === 'loss' ? 'loss' : ''}">${b.pnl >= 0 ? '+' : ''}$${b.pnl.toFixed(2)}</td><td><select onchange="updateStatus(${b.id}, this.value)" style="padding:6px;border:1px solid var(--border);border-radius:6px;background:var(--bg);color:var(--text);font-size:12px;"><option value="pending" ${b.status === 'pending' ? 'selected' : ''}>‚è≥</option><option value="win" ${b.status === 'win' ? 'selected' : ''}>‚úÖ</option><option value="loss" ${b.status === 'loss' ? 'selected' : ''}>‚ùå</option></select></td><td><button onclick="deleteBet(${b.id})" style="padding:6px 10px;background:var(--error-bg);color:var(--error);border:none;border-radius:6px;cursor:pointer;">‡∏•‡∏ö</button></td></tr>`).join('');
        }
        
        function formatNum(n) { return n >= 1e6 ? (n / 1e6).toFixed(1) + 'M' : n >= 1e3 ? (n / 1e3).toFixed(1) + 'K' : n.toFixed(0); }
        
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModalBtn(); });
        fetchMarkets();
    </script>
</body>
</html>
