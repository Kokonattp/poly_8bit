<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyTrader Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --background: #09090b;
            --foreground: #fafafa;
            --card: #18181b;
            --primary: #facc15;
            --primary-foreground: #09090b;
            --secondary: #27272a;
            --muted-foreground: #a1a1aa;
            --destructive: #ef4444;
            --success: #22c55e;
            --warning: #f59e0b;
            --info: #3b82f6;
            --purple: #a855f7;
            --pink: #ec4899;
            --border: #3f3f46;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Press Start 2P', monospace;
            background-color: var(--background);
            color: var(--foreground);
            min-height: 100vh;
            font-size: 10px;
            line-height: 2;
        }
        
        .thai { font-family: 'Sarabun', sans-serif; }
        
        .header {
            background: var(--card);
            padding: 12px 16px;
            border-bottom: 4px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-text { font-size: 12px; color: var(--primary); text-shadow: 2px 2px 0 #ca8a04; }
        .logo-badge { background: var(--purple); color: white; font-size: 6px; padding: 4px 8px; }
        
        .status-badge { display: flex; align-items: center; gap: 8px; font-size: 8px; color: var(--muted-foreground); }
        .status-dot { width: 8px; height: 8px; background: var(--success); animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        .status-badge.error .status-dot { background: var(--destructive); }
        .status-badge.loading .status-dot { background: var(--warning); }
        
        .main { max-width: 1200px; margin: 0 auto; padding: 16px; }
        
        .nes-btn { display: inline-block; padding: 8px 16px; font-family: inherit; font-size: 10px; color: var(--foreground); background: var(--secondary); border: none; cursor: pointer; text-transform: uppercase; box-shadow: inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #52525b; text-decoration: none; }
        .nes-btn:hover { color: var(--muted-foreground); }
        .nes-btn.is-primary { background: var(--primary); color: var(--primary-foreground); box-shadow: inset -4px -4px 0 0 #a16207, inset 4px 4px 0 0 #fef08a; }
        .nes-btn.is-success { background: var(--success); color: #052e16; box-shadow: inset -4px -4px 0 0 #15803d, inset 4px 4px 0 0 #86efac; }
        
        .tabs { display: flex; gap: 4px; margin-bottom: 16px; border-bottom: 4px solid var(--border); padding-bottom: 4px; }
        .tab-btn { padding: 12px 16px; font-family: inherit; font-size: 8px; background: var(--secondary); color: var(--muted-foreground); border: none; cursor: pointer; box-shadow: inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #52525b; }
        .tab-btn.active { background: var(--primary); color: var(--primary-foreground); box-shadow: inset -4px -4px 0 0 #a16207, inset 4px 4px 0 0 #fef08a; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .controls-row { display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; align-items: flex-end; }
        .control-group { display: flex; flex-direction: column; gap: 4px; }
        .control-label { font-size: 8px; color: var(--muted-foreground); }
        .nes-input { padding: 8px 12px; font-family: inherit; font-size: 10px; color: var(--foreground); background: var(--background); border: none; width: 100px; box-shadow: inset -4px -4px 0 0 #52525b, inset 4px 4px 0 0 #18181b; }
        .nes-input:focus { outline: none; box-shadow: inset -4px -4px 0 0 var(--primary), inset 4px 4px 0 0 #a16207; }
        
        .filter-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 16px; }
        .filter-btn { padding: 6px 10px; font-family: inherit; font-size: 7px; background: var(--secondary); color: var(--muted-foreground); border: 2px solid var(--border); cursor: pointer; }
        .filter-btn.active { background: var(--primary); color: var(--primary-foreground); border-color: var(--primary); }
        
        .stats-row { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
        .stat-badge { padding: 8px 12px; background: var(--secondary); font-size: 8px; color: var(--muted-foreground); }
        .stat-badge span { color: var(--primary); margin-left: 4px; }
        
        .quest-grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); }
        
        /* Market Card with Hover Popup */
        .quest-card {
            background: var(--card);
            box-shadow: 0 0 0 4px var(--border), inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #3f3f46;
            position: relative;
        }
        
        .quest-card.is-legendary { box-shadow: 0 0 0 4px var(--success), inset -4px -4px 0 0 #15803d, inset 4px 4px 0 0 #4ade80, 0 0 20px rgba(34, 197, 94, 0.3); }
        .quest-card.is-epic { box-shadow: 0 0 0 4px var(--info), inset -4px -4px 0 0 #1d4ed8, inset 4px 4px 0 0 #60a5fa; }
        .quest-card.is-rare { box-shadow: 0 0 0 4px var(--warning), inset -4px -4px 0 0 #b45309, inset 4px 4px 0 0 #fbbf24; }
        .quest-card.is-common { box-shadow: 0 0 0 4px var(--destructive), inset -4px -4px 0 0 #b91c1c, inset 4px 4px 0 0 #f87171; opacity: 0.7; }
        
        /* HOVER POPUP */
        .hover-popup {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 100;
            padding: 16px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .quest-card:hover .hover-popup {
            opacity: 1;
            visibility: visible;
        }
        
        .popup-header {
            border-bottom: 2px solid var(--primary);
            padding-bottom: 8px;
            margin-bottom: 12px;
        }
        
        .popup-header h3 {
            font-size: 9px;
            color: var(--primary);
            line-height: 1.6;
        }
        
        .popup-section {
            margin-bottom: 12px;
        }
        
        .popup-section h4 {
            font-size: 8px;
            color: var(--primary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .popup-section p,
        .popup-section li {
            font-family: 'Sarabun', sans-serif;
            font-size: 13px;
            color: var(--muted-foreground);
            line-height: 1.6;
        }
        
        .popup-section ul {
            padding-left: 16px;
            margin: 0;
        }
        
        .popup-section li {
            margin-bottom: 4px;
        }
        
        .popup-highlight {
            background: rgba(250, 204, 21, 0.2);
            color: var(--primary);
            padding: 1px 4px;
        }
        
        .popup-footer {
            margin-top: auto;
            padding-top: 12px;
            border-top: 2px solid var(--border);
            display: flex;
            gap: 8px;
        }
        
        .popup-footer .nes-btn {
            flex: 1;
            text-align: center;
        }
        
        .quest-header { padding: 12px 16px; border-bottom: 4px solid var(--border); display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 8px; }
        .quest-title { font-size: 9px; color: var(--foreground); line-height: 1.8; }
        .quest-meta { font-size: 7px; color: var(--muted-foreground); margin-top: 4px; display: flex; gap: 8px; flex-wrap: wrap; }
        .quest-meta .cat { padding: 2px 6px; font-size: 6px; }
        .quest-meta .cat.crypto { background: #f7931a; color: #000; }
        .quest-meta .cat.politics { background: var(--destructive); color: white; }
        .quest-meta .cat.sports { background: var(--success); color: #000; }
        .quest-meta .cat.entertainment { background: var(--pink); color: #000; }
        .quest-meta .cat.science { background: var(--info); color: white; }
        .quest-meta .cat.business { background: var(--purple); color: white; }
        .quest-meta .cat.other { background: #71717a; color: white; }
        
        .quest-badge { padding: 4px 8px; font-size: 6px; text-transform: uppercase; }
        .quest-badge.legendary { background: var(--success); color: #052e16; }
        .quest-badge.epic { background: var(--info); color: white; }
        .quest-badge.rare { background: var(--warning); color: #451a03; }
        .quest-badge.common { background: #71717a; color: white; }
        .quest-badge.pending { background: var(--secondary); color: var(--muted-foreground); }
        
        .stats-grid { display: grid; grid-template-columns: repeat(5, 1fr); border-bottom: 4px solid var(--border); }
        .stat-cell { padding: 10px 6px; text-align: center; border-right: 2px solid var(--border); }
        .stat-cell:last-child { border-right: none; }
        .stat-cell .label { font-size: 6px; color: var(--muted-foreground); margin-bottom: 4px; }
        .stat-cell .value { font-size: 11px; color: var(--foreground); }
        .stat-cell .value.positive { color: var(--success); }
        .stat-cell .value.negative { color: var(--destructive); }
        .stat-cell .value.neutral { color: var(--warning); }
        
        .quest-input { padding: 10px 16px; background: rgba(250, 204, 21, 0.05); display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .quest-input .nes-input { width: 60px; }
        .quest-input .label { font-size: 8px; color: var(--muted-foreground); }
        
        .quest-footer { padding: 10px 16px; border-top: 4px solid var(--border); display: flex; justify-content: space-between; align-items: center; font-size: 7px; color: var(--muted-foreground); }
        .quest-footer a { text-decoration: none; }
        
        .loading-state { text-align: center; padding: 48px 16px; grid-column: 1 / -1; }
        .loading-icon { font-size: 32px; animation: bounce 0.5s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-8px); } }
        .loading-text { margin-top: 16px; font-size: 10px; color: var(--primary); }
        
        .empty-state { text-align: center; padding: 48px 16px; color: var(--muted-foreground); grid-column: 1 / -1; }
        
        .search-box { flex: 1; min-width: 200px; }
        .search-box .nes-input { width: 100%; }
        
        /* Guide Tab */
        .guide-section { background: var(--card); margin-bottom: 16px; box-shadow: 0 0 0 4px var(--border), inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #3f3f46; }
        .guide-section.highlight { box-shadow: 0 0 0 4px var(--primary), inset -4px -4px 0 0 #a16207, inset 4px 4px 0 0 #fef08a; }
        .guide-header { padding: 16px; border-bottom: 4px solid var(--border); background: var(--secondary); }
        .guide-header h3 { font-size: 10px; color: var(--primary); }
        .guide-body { padding: 16px; }
        .guide-body p { font-family: 'Sarabun', sans-serif; font-size: 15px; color: var(--muted-foreground); line-height: 2; margin-bottom: 12px; }
        .guide-body strong { color: var(--foreground); }
        
        /* Portfolio */
        .portfolio-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 16px; }
        .portfolio-card { padding: 16px; background: var(--card); box-shadow: 0 0 0 4px var(--border), inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #3f3f46; }
        .portfolio-card .label { font-size: 8px; color: var(--primary); margin-bottom: 8px; }
        .portfolio-card .value { font-size: 18px; color: var(--foreground); }
        .portfolio-card .value.positive { color: var(--success); }
        .portfolio-card .value.negative { color: var(--destructive); }
        .portfolio-card .sub { font-size: 8px; color: var(--muted-foreground); margin-top: 4px; }
        
        .progress-bar { height: 16px; background: var(--secondary); box-shadow: inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #3f3f46; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--destructive), var(--warning), var(--success)); }
        
        .form-card { padding: 16px; margin-bottom: 16px; background: var(--card); box-shadow: 0 0 0 4px var(--primary), inset -4px -4px 0 0 #a16207, inset 4px 4px 0 0 #fef08a; }
        .form-card h3 { font-size: 10px; color: var(--primary); margin-bottom: 16px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 12px; }
        .form-group label { display: block; font-size: 8px; color: var(--muted-foreground); margin-bottom: 4px; }
        .form-group input, .form-group select { width: 100%; padding: 8px; font-family: inherit; font-size: 8px; color: var(--foreground); background: var(--background); border: none; box-shadow: inset -4px -4px 0 0 #52525b, inset 4px 4px 0 0 #18181b; }
        
        .table-container { overflow-x: auto; box-shadow: 0 0 0 4px var(--border); }
        table { width: 100%; border-collapse: collapse; background: var(--card); }
        th { padding: 12px; text-align: left; font-size: 8px; color: var(--primary); background: var(--secondary); }
        td { padding: 12px; font-size: 8px; border-bottom: 2px solid var(--border); }
        .win { color: var(--success); }
        .loss { color: var(--destructive); }
        
        /* Hover hint */
        .hover-hint {
            font-family: 'Sarabun', sans-serif;
            font-size: 11px;
            color: var(--muted-foreground);
            text-align: center;
            padding: 8px;
            background: var(--secondary);
            margin-bottom: 16px;
        }
        
        @media (max-width: 600px) {
            .stats-grid { grid-template-columns: repeat(3, 1fr); }
            .quest-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <span style="font-size: 20px;">üéÆ</span>
            <span class="logo-text">POLYTRADER</span>
            <span class="logo-badge">PRO</span>
        </div>
        <div class="status-badge" id="statusBadge">
            <div class="status-dot"></div>
            <span id="statusText">CONNECTING...</span>
        </div>
    </header>
    
    <main class="main">
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('scanner')">üîç ‡∏ï‡∏•‡∏≤‡∏î</button>
            <button class="tab-btn" onclick="showTab('portfolio')">üí∞ ‡∏û‡∏≠‡∏£‡πå‡∏ï</button>
            <button class="tab-btn" onclick="showTab('guide')">üìñ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠</button>
        </div>
        
        <!-- Scanner Tab -->
        <div class="tab-content active" id="tab-scanner">
            <div class="controls-row">
                <div class="control-group">
                    <span class="control-label">üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏ô ($)</span>
                    <input type="number" class="nes-input" id="bankroll" value="100">
                </div>
                <div class="control-group">
                    <span class="control-label">üéØ EDGE ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</span>
                    <input type="number" class="nes-input" id="minEdge" value="5">
                </div>
                <div class="control-group search-box">
                    <span class="control-label">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span>
                    <input type="text" class="nes-input" id="searchInput" placeholder="BITCOIN, TRUMP..." oninput="filterMarkets()">
                </div>
                <button class="nes-btn is-primary" onclick="fetchMarkets()">‚ü≥ ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà</button>
            </div>
            
            <div class="filter-row">
                <button class="filter-btn active" data-cat="all" onclick="filterCategory('all', this)">üåê ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="filter-btn" data-cat="crypto" onclick="filterCategory('crypto', this)">‚Çø ‡∏Ñ‡∏£‡∏¥‡∏õ‡πÇ‡∏ï</button>
                <button class="filter-btn" data-cat="politics" onclick="filterCategory('politics', this)">üèõÔ∏è ‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á</button>
                <button class="filter-btn" data-cat="sports" onclick="filterCategory('sports', this)">‚öΩ ‡∏Å‡∏µ‡∏¨‡∏≤</button>
                <button class="filter-btn" data-cat="entertainment" onclick="filterCategory('entertainment', this)">üé¨ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</button>
                <button class="filter-btn" data-cat="science" onclick="filterCategory('science', this)">üî¨ AI/‡∏ß‡∏¥‡∏ó‡∏¢‡πå</button>
                <button class="filter-btn" data-cat="business" onclick="filterCategory('business', this)">üíº ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</button>
            </div>
            
            <div class="hover-hint">üí° ‡πÄ‡∏≠‡∏≤‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤ Model%</div>
            
            <div class="stats-row">
                <div class="stat-badge">‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:<span id="totalMarkets">0</span></div>
                <div class="stat-badge">‡πÅ‡∏™‡∏î‡∏á:<span id="filteredMarkets">0</span></div>
                <div class="stat-badge">‡πÄ‡∏ß‡∏•‡∏≤:<span id="lastUpdate">--:--</span></div>
            </div>
            
            <div class="quest-grid" id="questGrid">
                <div class="loading-state">
                    <div class="loading-icon">üîÆ</div>
                    <div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                </div>
            </div>
        </div>
        
        <!-- Portfolio Tab -->
        <div class="tab-content" id="tab-portfolio">
            <div class="portfolio-grid">
                <div class="portfolio-card">
                    <div class="label">üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏ô</div>
                    <div class="value" id="pBankroll">$100</div>
                    <div class="progress-bar" style="margin-top: 8px;"><div class="progress-fill" id="hpFill" style="width: 100%;"></div></div>
                </div>
                <div class="portfolio-card">
                    <div class="label">üìà ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</div>
                    <div class="value positive" id="pPnL">+$0</div>
                    <div class="sub" id="pPnLPct">0%</div>
                </div>
                <div class="portfolio-card">
                    <div class="label">üéØ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ä‡∏ô‡∏∞</div>
                    <div class="value" id="pWinRate">0%</div>
                    <div class="sub" id="pWinLoss">0W - 0L</div>
                </div>
            </div>
            
            <div class="form-card">
                <h3>‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</h3>
                <div class="form-row">
                    <div class="form-group"><label>‡∏ï‡∏•‡∏≤‡∏î</label><input type="text" id="betEvent" placeholder="BITCOIN >100K"></div>
                    <div class="form-group"><label>‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏á ($)</label><input type="number" id="betStake" placeholder="5"></div>
                    <div class="form-group"><label>‡∏£‡∏≤‡∏Ñ‡∏≤ (¬¢)</label><input type="number" id="betPrice" placeholder="55"></div>
                    <div class="form-group"><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label><select id="betStatus"><option value="pending">‚è≥ ‡∏£‡∏≠‡∏ú‡∏•</option><option value="win">‚úÖ ‡∏ä‡∏ô‡∏∞</option><option value="loss">‚ùå ‡πÅ‡∏û‡πâ</option></select></div>
                </div>
                <button class="nes-btn is-primary" onclick="addBet()">+ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ï‡∏•‡∏≤‡∏î</th><th>‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏á</th><th>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th></th></tr></thead>
                    <tbody id="betsTable"><tr><td colspan="6" style="text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td></tr></tbody>
                </table>
            </div>
        </div>
        
        <!-- Guide Tab -->
        <div class="tab-content" id="tab-guide">
            <div class="guide-section highlight">
                <div class="guide-header"><h3>‚ùì ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á?</h3></div>
                <div class="guide-body">
                    <p><strong>1.</strong> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    <p><strong>2.</strong> ‡πÄ‡∏≠‡∏≤‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î ‚Üí ‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô Popup ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå</p>
                    <p><strong>3.</strong> ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏™‡πà Model%</p>
                    <p><strong>4.</strong> ‡∏Å‡∏î CALC ‡∏î‡∏π EDGE ‚Üí ‡∏ñ‡πâ‡∏≤ ‚â•5% ‡∏ô‡πà‡∏≤‡πÄ‡∏ó‡∏£‡∏î!</p>
                    <p><strong>5.</strong> ‡∏Å‡∏î TRADE ‡πÑ‡∏õ‡∏ã‡∏∑‡πâ‡∏≠‡∏ö‡∏ô Polymarket</p>
                </div>
            </div>
            
            <div class="guide-section">
                <div class="guide-header"><h3>üìä ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</h3></div>
                <div class="guide-body">
                    <p><strong>PRICE</strong> = ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠ (35¬¢ = ‡∏à‡πà‡∏≤‡∏¢ 35 ‡πÄ‡∏ã‡∏ô‡∏ï‡πå ‡∏ñ‡πâ‡∏≤‡∏ä‡∏ô‡∏∞‡πÑ‡∏î‡πâ $1)</p>
                    <p><strong>IMPLIED</strong> = ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏ï‡∏•‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î (35¬¢ = 35%)</p>
                    <p><strong>MODEL</strong> = ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏£‡∏¥‡∏á</p>
                    <p><strong>EDGE</strong> = Model - Implied (‡∏ñ‡πâ‡∏≤ + ‡∏Ñ‡∏∑‡∏≠‡∏ô‡πà‡∏≤‡πÄ‡∏ó‡∏£‡∏î)</p>
                    <p><strong>EV</strong> = ‡∏Å‡∏≥‡πÑ‡∏£‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏ï‡πà‡∏≠ $100</p>
                </div>
            </div>
            
            <div class="guide-section">
                <div class="guide-header"><h3>üèÜ ‡∏£‡∏∞‡∏ö‡∏ö Rarity</h3></div>
                <div class="guide-body">
                    <p>üöÄ <strong>LEGENDARY</strong> (EDGE ‚â•10%) = ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏≠‡∏á! ‡πÄ‡∏ó‡∏£‡∏î‡πÄ‡∏•‡∏¢</p>
                    <p>‚ú® <strong>EPIC</strong> (EDGE 5-9%) = ‡∏ô‡πà‡∏≤‡πÄ‡∏ó‡∏£‡∏î</p>
                    <p>üî∂ <strong>RARE</strong> (EDGE 0-4%) = ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</p>
                    <p>üíÄ <strong>SKIP</strong> (EDGE <0%) = ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ!</p>
                </div>
            </div>
            
            <div class="guide-section">
                <div class="guide-header"><h3>üí∞ ‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h3></div>
                <div class="guide-body">
                    <p>‚ö†Ô∏è ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô <strong>5%</strong> ‡∏Ç‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î</p>
                    <p>üõë ‡∏´‡∏¢‡∏∏‡∏î‡∏ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô <strong>20%</strong></p>
                    <p>‚ùå ‡∏´‡πâ‡∏≤‡∏°‡πÑ‡∏•‡πà‡∏ï‡∏≤‡∏°‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</p>
                </div>
            </div>
        </div>
    </main>
    
    <script>
        const API_URL = '/api/polymarket';
        let allMarkets = [];
        let currentCategory = 'all';
        let bets = JSON.parse(localStorage.getItem('polytrader_bets') || '[]');
        
        const categoryKeywords = {
            crypto: ['bitcoin', 'btc', 'ethereum', 'eth', 'crypto', 'solana', 'xrp', 'doge', 'defi', 'nft', 'binance', 'coinbase', 'etf'],
            politics: ['trump', 'biden', 'election', 'president', 'congress', 'senate', 'republican', 'democrat', 'xi', 'putin', 'ukraine', 'russia', 'china', 'iran', 'israel', 'gaza', 'war', 'government', 'vote', 'governor', 'political'],
            sports: ['nba', 'nfl', 'nhl', 'mlb', 'soccer', 'football', 'basketball', 'baseball', 'hockey', 'ufc', 'mma', 'boxing', 'tennis', 'golf', 'olympics', 'championship', 'playoff', 'finals', 'super bowl', 'world cup', ' vs '],
            entertainment: ['movie', 'oscar', 'grammy', 'emmy', 'actor', 'actress', 'film', 'album', 'celebrity', 'swift', 'beyonce', 'netflix', 'disney', 'streaming'],
            science: ['ai', 'artificial intelligence', 'openai', 'chatgpt', 'gpt', 'tesla', 'spacex', 'mars', 'nasa', 'space', 'rocket', 'climate', 'vaccine', 'fda', 'quantum', 'robot'],
            business: ['ipo', 'stock', 'merger', 'acquisition', 'ceo', 'company', 'revenue', 'earnings', 'nasdaq', 'fed', 'interest rate', 'inflation', 'recession', 'gdp', 'economy']
        };
        
        // ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)
        const strategies = {
            crypto: {
                icon: '‚Çø',
                name: '‡∏Ñ‡∏£‡∏¥‡∏õ‡πÇ‡∏ï',
                howTo: [
                    '‡∏î‡∏π‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞ Technical Analysis ‡∏ö‡∏ô TradingView',
                    '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Crypto analysts ‡∏ö‡∏ô Twitter/X',
                    '‡∏î‡∏π On-chain data (Glassnode, CryptoQuant)',
                    '‡∏®‡∏∂‡∏Å‡∏©‡∏≤ Halving cycles ‡∏Ç‡∏≠‡∏á Bitcoin'
                ],
                tips: [
                    'Bitcoin ‡∏°‡∏±‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á Halving 12-18 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
                    '‡∏Ç‡πà‡∏≤‡∏ß ETF ‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å',
                    '‡∏î‡∏π Fear & Greed Index ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö'
                ],
                sources: 'TradingView, CoinGecko, Glassnode'
            },
            politics: {
                icon: 'üèõÔ∏è',
                name: '‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á',
                howTo: [
                    '‡∏î‡∏π Polls ‡∏à‡∏≤‡∏Å FiveThirtyEight, RealClearPolitics',
                    '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏à‡∏≤‡∏Å Reuters, AP News',
                    '‡∏î‡∏π Prediction markets ‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö',
                    '‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤'
                ],
                tips: [
                    'Polls ‡∏≠‡∏≤‡∏à‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô 3-5%',
                    '‡∏î‡∏π Electoral map ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á',
                    '‡∏Ç‡πà‡∏≤‡∏ß October Surprise ‡∏°‡∏µ‡∏ú‡∏•‡∏°‡∏≤‡∏Å'
                ],
                sources: 'FiveThirtyEight, RealClearPolitics'
            },
            sports: {
                icon: '‚öΩ',
                name: '‡∏Å‡∏µ‡∏¨‡∏≤',
                howTo: [
                    '‡∏î‡∏π Odds ‡∏à‡∏≤‡∏Å FanDuel, DraftKings ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô %',
                    '‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡πà‡∏≤‡∏ß‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤',
                    '‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Head-to-head',
                    '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° ESPN predictions'
                ],
                tips: [
                    'Odds -150 = 60%, +200 = 33%',
                    'Home advantage ‡∏°‡∏µ‡∏ú‡∏• ~3-5%',
                    'Back-to-back games ‡∏ó‡∏µ‡∏°‡∏°‡∏±‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢'
                ],
                sources: 'FanDuel, DraftKings, ESPN'
            },
            entertainment: {
                icon: 'üé¨',
                name: '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á',
                howTo: [
                    '‡∏î‡∏π Critics reviews ‡πÅ‡∏•‡∏∞ Audience scores',
                    '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Awards prediction sites',
                    '‡∏î‡∏π Social media buzz',
                    '‡πÄ‡∏ä‡πá‡∏Ñ Box office predictions'
                ],
                tips: [
                    'Oscar ‡∏°‡∏±‡∏Å‡∏°‡∏µ "narrative" ‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö',
                    '‡∏î‡∏π Guild awards ‡∏Å‡πà‡∏≠‡∏ô Oscar',
                    'Box office weekend ‡πÅ‡∏£‡∏Å‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç'
                ],
                sources: 'Rotten Tomatoes, Gold Derby'
            },
            science: {
                icon: 'üî¨',
                name: 'AI/‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                howTo: [
                    '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡πà‡∏≤‡∏ß Tech ‡∏à‡∏≤‡∏Å The Verge, TechCrunch',
                    '‡∏î‡∏π Official announcements',
                    '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° CEO ‡∏ö‡∏ô Twitter/X',
                    '‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£ release ‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó'
                ],
                tips: [
                    'Tech companies ‡∏°‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤',
                    'Elon Musk timelines ‡∏°‡∏±‡∏Å‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á',
                    '‡∏î‡∏π Earnings calls ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö hints'
                ],
                sources: 'The Verge, TechCrunch, Company blogs'
            },
            business: {
                icon: 'üíº',
                name: '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à',
                howTo: [
                    '‡∏î‡∏π Analyst reports ‡∏à‡∏≤‡∏Å Bloomberg',
                    '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Fed statements',
                    '‡∏î‡∏π Economic indicators (GDP, CPI)',
                    '‡πÄ‡∏ä‡πá‡∏Ñ IPO filings'
                ],
                tips: [
                    'Fed ‡∏°‡∏±‡∏Å‡∏ö‡∏≠‡∏Å forward guidance ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤',
                    '‡∏î‡∏π CME FedWatch ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö rate predictions',
                    'Earnings season ‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏±‡∏ö sentiment'
                ],
                sources: 'Bloomberg, Reuters, CNBC'
            },
            other: {
                icon: 'üìä',
                name: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
                howTo: [
                    '‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡∏±‡πâ‡∏ô',
                    '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á',
                    '‡∏î‡∏π Historical data ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ'
                ],
                tips: [
                    '‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏ó‡∏£‡∏î',
                    '‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô'
                ],
                sources: 'Google News, Expert blogs'
            }
        };
        
        function detectCategory(title, slug) {
            const text = (title + ' ' + slug).toLowerCase();
            for (const [cat, keywords] of Object.entries(categoryKeywords)) {
                for (const kw of keywords) {
                    if (text.includes(kw)) return cat;
                }
            }
            return 'other';
        }
        
        function showTab(name) {
            document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(`tab-${name}`).classList.add('active');
            if (name === 'portfolio') updatePortfolio();
        }
        
        function generatePopupHTML(m) {
            const s = strategies[m.category] || strategies.other;
            const implied = (m.price * 100).toFixed(1);
            
            return `
                <div class="popup-header">
                    <h3>${s.icon} ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå: ${s.name}</h3>
                </div>
                
                <div class="popup-section">
                    <h4>üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡∏µ‡πâ</h4>
                    <p>‡∏£‡∏≤‡∏Ñ‡∏≤: <span class="popup-highlight">${(m.price*100).toFixed(0)}¬¢</span> = ‡∏ï‡∏•‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™ <span class="popup-highlight">${implied}%</span></p>
                    <p>Volume: $${formatNum(m.volume)}</p>
                </div>
                
                <div class="popup-section">
                    <h4>üéØ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤ Model%</h4>
                    <ul>
                        ${s.howTo.map(h => `<li>${h}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="popup-section">
                    <h4>üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö</h4>
                    <ul>
                        ${s.tips.map(t => `<li>${t}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="popup-section">
                    <h4>üìö ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                    <p>${s.sources}</p>
                </div>
                
                <div class="popup-footer">
                    <a href="${m.url}" target="_blank" class="nes-btn is-primary">üéÆ ‡πÑ‡∏õ‡πÄ‡∏ó‡∏£‡∏î‡πÄ‡∏•‡∏¢!</a>
                </div>
            `;
        }
        
        async function fetchMarkets() {
            const grid = document.getElementById('questGrid');
            const statusBadge = document.getElementById('statusBadge');
            const statusText = document.getElementById('statusText');
            
            grid.innerHTML = '<div class="loading-state"><div class="loading-icon">üîÆ</div><div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>';
            statusBadge.className = 'status-badge loading';
            statusText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
            
            try {
                const response = await fetch(`${API_URL}?endpoint=events&closed=false&limit=200`);
                if (!response.ok) throw new Error(`ERROR ${response.status}`);
                const events = await response.json();
                
                allMarkets = events.map(e => {
                    const m = e.markets?.[0] || {};
                    let price = 0;
                    if (m.outcomePrices) { try { price = parseFloat(JSON.parse(m.outcomePrices)[0]) || 0; } catch {} }
                    return {
                        id: e.id,
                        title: e.title?.toUpperCase() || 'UNKNOWN',
                        slug: e.slug || '',
                        endDate: e.endDate,
                        category: detectCategory(e.title || '', e.slug || ''),
                        price,
                        volume: parseFloat(m.volume) || 0,
                        url: `https://polymarket.com/event/${e.slug}`
                    };
                }).filter(m => m.price > 0.01 && m.price < 0.99);
                
                allMarkets.sort((a, b) => b.volume - a.volume);
                
                statusBadge.className = 'status-badge';
                statusText.textContent = `üü¢ LIVE ¬∑ ${allMarkets.length}`;
                document.getElementById('totalMarkets').textContent = allMarkets.length;
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'});
                filterMarkets();
            } catch (err) {
                statusBadge.className = 'status-badge error';
                statusText.textContent = 'üî¥ OFFLINE';
                grid.innerHTML = `<div class="empty-state"><p>‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${err.message}</p><button class="nes-btn is-primary" onclick="fetchMarkets()" style="margin-top:16px;">‚Üª ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button></div>`;
            }
        }
        
        function filterCategory(cat, btn) {
            currentCategory = cat;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            filterMarkets();
        }
        
        function filterMarkets() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            let filtered = allMarkets;
            if (currentCategory !== 'all') filtered = filtered.filter(m => m.category === currentCategory);
            if (search) filtered = filtered.filter(m => m.title.toLowerCase().includes(search) || m.slug.toLowerCase().includes(search));
            document.getElementById('filteredMarkets').textContent = filtered.length;
            renderMarkets(filtered);
        }
        
        function renderMarkets(markets) {
            const grid = document.getElementById('questGrid');
            if (!markets.length) { grid.innerHTML = '<div class="empty-state"><p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏•‡∏≤‡∏î</p></div>'; return; }
            
            const icons = { crypto: '‚Çø', politics: 'üèõÔ∏è', sports: '‚öΩ', entertainment: 'üé¨', science: 'üî¨', business: 'üíº', other: 'üìä' };
            
            grid.innerHTML = markets.slice(0, 50).map((m, i) => {
                const icon = icons[m.category] || 'üìä';
                const endDate = m.endDate ? new Date(m.endDate).toLocaleDateString('th-TH', { day: 'numeric', month: 'short' }) : '';
                
                return `
                    <div class="quest-card" id="card-${i}">
                        <!-- HOVER POPUP -->
                        <div class="hover-popup">
                            ${generatePopupHTML(m)}
                        </div>
                        
                        <div class="quest-header">
                            <div>
                                <div class="quest-title">${icon} ${m.title}</div>
                                <div class="quest-meta">
                                    <span class="cat ${m.category}">${m.category.toUpperCase()}</span>
                                    ${endDate ? `<span>üìÖ ${endDate}</span>` : ''}
                                </div>
                            </div>
                            <span class="quest-badge pending" id="badge-${i}">‡πÉ‡∏™‡πà MODEL%</span>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-cell"><div class="label">‡∏£‡∏≤‡∏Ñ‡∏≤</div><div class="value">${(m.price*100).toFixed(0)}¬¢</div></div>
                            <div class="stat-cell"><div class="label">IMPLIED</div><div class="value">${(m.price*100).toFixed(1)}%</div></div>
                            <div class="stat-cell"><div class="label">MODEL</div><div class="value" id="model-${i}">--</div></div>
                            <div class="stat-cell"><div class="label">EDGE</div><div class="value" id="edge-${i}">--</div></div>
                            <div class="stat-cell"><div class="label">EV</div><div class="value" id="ev-${i}">--</div></div>
                        </div>
                        <div class="quest-input">
                            <span class="label">MODEL%:</span>
                            <input type="number" class="nes-input" id="input-${i}" placeholder="65" min="1" max="99" onclick="event.stopPropagation()">
                            <button class="nes-btn is-success" onclick="event.stopPropagation(); calculate(${i}, ${m.price})">CALC</button>
                        </div>
                        <div class="quest-footer">
                            <span>VOL: $${formatNum(m.volume)}</span>
                            <a href="${m.url}" target="_blank" class="nes-btn is-primary" onclick="event.stopPropagation()">üéÆ TRADE</a>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function calculate(i, price) {
            const model = parseFloat(document.getElementById(`input-${i}`).value);
            if (!model || model < 1 || model > 99) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà MODEL% (1-99)'); return; }
            const minEdge = parseFloat(document.getElementById('minEdge').value) || 5;
            const edge = model - (price * 100);
            const ev = ((model / 100) * (100 * (1/price - 1))) - ((1 - model / 100) * 100);
            
            document.getElementById(`model-${i}`).textContent = `${model}%`;
            document.getElementById(`model-${i}`).className = 'value positive';
            
            const edgeEl = document.getElementById(`edge-${i}`);
            edgeEl.textContent = `${edge >= 0 ? '+' : ''}${edge.toFixed(0)}%`;
            edgeEl.className = `value ${edge >= minEdge ? 'positive' : edge >= 0 ? 'neutral' : 'negative'}`;
            
            const evEl = document.getElementById(`ev-${i}`);
            evEl.textContent = `${ev >= 0 ? '+' : ''}$${ev.toFixed(0)}`;
            evEl.className = `value ${ev >= 0 ? 'positive' : 'negative'}`;
            
            const badge = document.getElementById(`badge-${i}`);
            const card = document.getElementById(`card-${i}`);
            card.classList.remove('is-legendary', 'is-epic', 'is-rare', 'is-common');
            
            if (edge >= 10) { badge.textContent = 'üöÄ LEGENDARY'; badge.className = 'quest-badge legendary'; card.classList.add('is-legendary'); }
            else if (edge >= minEdge) { badge.textContent = '‚ú® EPIC'; badge.className = 'quest-badge epic'; card.classList.add('is-epic'); }
            else if (edge >= 0) { badge.textContent = 'üî∂ RARE'; badge.className = 'quest-badge rare'; card.classList.add('is-rare'); }
            else { badge.textContent = 'üíÄ SKIP'; badge.className = 'quest-badge common'; card.classList.add('is-common'); }
        }
        
        function addBet() {
            const event = document.getElementById('betEvent').value?.toUpperCase();
            const stake = parseFloat(document.getElementById('betStake').value);
            const price = parseFloat(document.getElementById('betPrice').value) / 100;
            const status = document.getElementById('betStatus').value;
            if (!event || !stake || !price) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'); return; }
            const pnl = status === 'win' ? (stake / price) - stake : status === 'loss' ? -stake : 0;
            bets.unshift({ id: Date.now(), date: new Date().toISOString(), event, stake, price, status, pnl });
            localStorage.setItem('polytrader_bets', JSON.stringify(bets));
            document.getElementById('betEvent').value = '';
            document.getElementById('betStake').value = '';
            document.getElementById('betPrice').value = '';
            updatePortfolio();
        }
        
        function updateStatus(id, status) {
            const bet = bets.find(b => b.id === id);
            if (bet) { bet.status = status; bet.pnl = status === 'win' ? (bet.stake / bet.price) - bet.stake : status === 'loss' ? -bet.stake : 0; localStorage.setItem('polytrader_bets', JSON.stringify(bets)); updatePortfolio(); }
        }
        
        function deleteBet(id) { if (confirm('‡∏•‡∏ö?')) { bets = bets.filter(b => b.id !== id); localStorage.setItem('polytrader_bets', JSON.stringify(bets)); updatePortfolio(); } }
        
        function updatePortfolio() {
            const bankroll = parseFloat(document.getElementById('bankroll').value) || 100;
            const wins = bets.filter(b => b.status === 'win');
            const losses = bets.filter(b => b.status === 'loss');
            const totalPnL = bets.reduce((s, b) => s + b.pnl, 0);
            const current = bankroll + totalPnL;
            const winRate = wins.length + losses.length > 0 ? (wins.length / (wins.length + losses.length) * 100).toFixed(0) : 0;
            
            document.getElementById('pBankroll').textContent = `$${current.toFixed(0)}`;
            document.getElementById('pPnL').textContent = `${totalPnL >= 0 ? '+' : ''}$${totalPnL.toFixed(0)}`;
            document.getElementById('pPnL').className = `value ${totalPnL >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('pPnLPct').textContent = `${(totalPnL / bankroll * 100).toFixed(0)}%`;
            document.getElementById('pWinRate').textContent = `${winRate}%`;
            document.getElementById('pWinLoss').textContent = `${wins.length}W - ${losses.length}L`;
            document.getElementById('hpFill').style.width = `${Math.max(0, Math.min(100, (current / bankroll) * 100))}%`;
            
            const tbody = document.getElementById('betsTable');
            if (!bets.length) { tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td></tr>'; return; }
            tbody.innerHTML = bets.map(b => {
                const date = new Date(b.date).toLocaleDateString('th-TH', { day: 'numeric', month: 'short' });
                const pnlClass = b.status === 'win' ? 'win' : b.status === 'loss' ? 'loss' : '';
                return `<tr><td>${date}</td><td>${b.event}</td><td>$${b.stake}</td><td class="${pnlClass}">${b.pnl >= 0 ? '+' : ''}$${b.pnl.toFixed(0)}</td><td><select onchange="updateStatus(${b.id}, this.value)" style="background:var(--background);border:none;color:var(--foreground);font-family:inherit;font-size:8px;padding:4px;"><option value="pending" ${b.status === 'pending' ? 'selected' : ''}>‚è≥</option><option value="win" ${b.status === 'win' ? 'selected' : ''}>‚úÖ</option><option value="loss" ${b.status === 'loss' ? 'selected' : ''}>‚ùå</option></select></td><td><button onclick="deleteBet(${b.id})" style="background:var(--destructive);color:white;border:none;padding:4px 8px;font-size:8px;cursor:pointer;">X</button></td></tr>`;
            }).join('');
        }
        
        function formatNum(n) { if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M'; if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K'; return n.toFixed(0); }
        
        fetchMarkets();
    </script>
</body>
</html>
