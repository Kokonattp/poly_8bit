<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyTrader - 8bitcn Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --background: #09090b;
            --foreground: #fafafa;
            --card: #18181b;
            --primary: #facc15;
            --primary-foreground: #09090b;
            --secondary: #27272a;
            --muted: #27272a;
            --muted-foreground: #a1a1aa;
            --destructive: #ef4444;
            --success: #22c55e;
            --warning: #f59e0b;
            --info: #3b82f6;
            --border: #3f3f46;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Press Start 2P', monospace;
            background-color: var(--background);
            color: var(--foreground);
            min-height: 100vh;
            font-size: 10px;
            line-height: 2;
        }
        
        /* NES-style box shadow border */
        .nes-container {
            position: relative;
            margin: 4px;
            padding: 16px;
            background: var(--card);
            box-shadow:
                0 0 0 4px var(--border),
                inset -4px -4px 0 0 #18181b,
                inset 4px 4px 0 0 #3f3f46;
        }
        
        .nes-container.is-primary {
            box-shadow:
                0 0 0 4px var(--primary),
                inset -4px -4px 0 0 #ca8a04,
                inset 4px 4px 0 0 #fde047;
        }
        
        .nes-container.is-success {
            box-shadow:
                0 0 0 4px var(--success),
                inset -4px -4px 0 0 #15803d,
                inset 4px 4px 0 0 #4ade80;
        }
        
        .nes-container.is-error {
            box-shadow:
                0 0 0 4px var(--destructive),
                inset -4px -4px 0 0 #b91c1c,
                inset 4px 4px 0 0 #f87171;
        }
        
        /* Header */
        .header {
            background: var(--card);
            padding: 12px 16px;
            border-bottom: 4px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-text {
            font-size: 12px;
            color: var(--primary);
            text-shadow: 2px 2px 0 #ca8a04;
        }
        
        .logo-badge {
            background: var(--primary);
            color: var(--primary-foreground);
            font-size: 6px;
            padding: 4px 8px;
            animation: blink 1s steps(2) infinite;
        }
        
        @keyframes blink { 50% { opacity: 0; } }
        
        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 8px;
            color: var(--muted-foreground);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .status-badge.error .status-dot { background: var(--destructive); }
        .status-badge.loading .status-dot { background: var(--warning); }
        
        .main { max-width: 1100px; margin: 0 auto; padding: 16px; }
        
        /* NES Button */
        .nes-btn {
            position: relative;
            display: inline-block;
            padding: 8px 16px;
            font-family: inherit;
            font-size: 10px;
            color: var(--foreground);
            background: var(--secondary);
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow:
                inset -4px -4px 0 0 #18181b,
                inset 4px 4px 0 0 #52525b;
        }
        
        .nes-btn:hover { color: var(--muted-foreground); }
        .nes-btn:active { box-shadow: inset 4px 4px 0 0 #18181b, inset -4px -4px 0 0 #52525b; }
        
        .nes-btn.is-primary {
            background: var(--primary);
            color: var(--primary-foreground);
            box-shadow: inset -4px -4px 0 0 #a16207, inset 4px 4px 0 0 #fef08a;
        }
        
        .nes-btn.is-success {
            background: var(--success);
            color: #052e16;
            box-shadow: inset -4px -4px 0 0 #15803d, inset 4px 4px 0 0 #86efac;
        }
        
        .nes-btn.is-error {
            background: var(--destructive);
            color: white;
            box-shadow: inset -4px -4px 0 0 #b91c1c, inset 4px 4px 0 0 #fca5a5;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            border-bottom: 4px solid var(--border);
            padding-bottom: 4px;
        }
        
        .tab-btn {
            padding: 12px 16px;
            font-family: inherit;
            font-size: 8px;
            background: var(--secondary);
            color: var(--muted-foreground);
            border: none;
            cursor: pointer;
            box-shadow: inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #52525b;
        }
        
        .tab-btn:hover { color: var(--foreground); }
        
        .tab-btn.active {
            background: var(--primary);
            color: var(--primary-foreground);
            box-shadow: inset -4px -4px 0 0 #a16207, inset 4px 4px 0 0 #fef08a;
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Controls */
        .controls-row {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        
        .control-group { display: flex; flex-direction: column; gap: 4px; }
        .control-label { font-size: 8px; color: var(--muted-foreground); }
        
        .nes-input {
            padding: 8px 12px;
            font-family: inherit;
            font-size: 10px;
            color: var(--foreground);
            background: var(--background);
            border: none;
            width: 80px;
            box-shadow: inset -4px -4px 0 0 #52525b, inset 4px 4px 0 0 #18181b;
        }
        
        .nes-input:focus {
            outline: none;
            box-shadow: inset -4px -4px 0 0 var(--primary), inset 4px 4px 0 0 #a16207;
        }
        
        /* Filters */
        .filter-row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
        
        .filter-btn {
            padding: 6px 12px;
            font-family: inherit;
            font-size: 8px;
            background: var(--secondary);
            color: var(--muted-foreground);
            border: 2px solid var(--border);
            cursor: pointer;
        }
        
        .filter-btn:hover { border-color: var(--primary); color: var(--primary); }
        .filter-btn.active { background: var(--primary); color: var(--primary-foreground); border-color: var(--primary); }
        
        /* Stats */
        .stats-row { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
        
        .stat-badge {
            padding: 8px 12px;
            background: var(--secondary);
            font-size: 8px;
            color: var(--muted-foreground);
            box-shadow: inset -2px -2px 0 0 #18181b, inset 2px 2px 0 0 #3f3f46;
        }
        
        .stat-badge span { color: var(--primary); margin-left: 4px; }
        
        /* Quest Card */
        .quest-grid { display: grid; gap: 16px; }
        
        .quest-card {
            background: var(--card);
            box-shadow: 0 0 0 4px var(--border), inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #3f3f46;
        }
        
        .quest-card.is-legendary {
            box-shadow: 0 0 0 4px var(--success), inset -4px -4px 0 0 #15803d, inset 4px 4px 0 0 #4ade80, 0 0 20px rgba(34, 197, 94, 0.3);
        }
        
        .quest-card.is-epic {
            box-shadow: 0 0 0 4px var(--info), inset -4px -4px 0 0 #1d4ed8, inset 4px 4px 0 0 #60a5fa;
        }
        
        .quest-card.is-rare {
            box-shadow: 0 0 0 4px var(--warning), inset -4px -4px 0 0 #b45309, inset 4px 4px 0 0 #fbbf24;
        }
        
        .quest-card.is-common {
            box-shadow: 0 0 0 4px var(--destructive), inset -4px -4px 0 0 #b91c1c, inset 4px 4px 0 0 #f87171;
            opacity: 0.7;
        }
        
        .quest-header {
            padding: 12px 16px;
            border-bottom: 4px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .quest-title { font-size: 10px; color: var(--foreground); line-height: 1.8; }
        .quest-meta { font-size: 8px; color: var(--primary); margin-top: 4px; }
        
        .quest-badge {
            padding: 4px 8px;
            font-size: 6px;
            text-transform: uppercase;
            animation: blink 1.5s steps(2) infinite;
        }
        
        .quest-badge.legendary { background: var(--success); color: #052e16; }
        .quest-badge.epic { background: var(--info); color: white; }
        .quest-badge.rare { background: var(--warning); color: #451a03; }
        .quest-badge.common { background: var(--muted); color: var(--muted-foreground); animation: none; }
        .quest-badge.pending { background: var(--secondary); color: var(--muted-foreground); animation: none; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            border-bottom: 4px solid var(--border);
        }
        
        .stat-cell {
            padding: 12px 8px;
            text-align: center;
            border-right: 2px solid var(--border);
        }
        
        .stat-cell:last-child { border-right: none; }
        .stat-cell .label { font-size: 6px; color: var(--muted-foreground); margin-bottom: 4px; }
        .stat-cell .value { font-size: 12px; color: var(--foreground); }
        .stat-cell .value.positive { color: var(--success); }
        .stat-cell .value.negative { color: var(--destructive); }
        .stat-cell .value.neutral { color: var(--warning); }
        
        .quest-input {
            padding: 12px 16px;
            background: rgba(250, 204, 21, 0.05);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .quest-input .nes-input { width: 60px; }
        .quest-input .label { font-size: 8px; color: var(--muted-foreground); }
        
        .quest-footer {
            padding: 12px 16px;
            border-top: 4px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 8px;
            color: var(--muted-foreground);
        }
        
        .quest-footer a { text-decoration: none; }
        
        /* Progress Bar */
        .progress-bar {
            height: 16px;
            background: var(--secondary);
            box-shadow: inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #3f3f46;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--destructive), var(--warning), var(--success));
            transition: width 0.3s;
        }
        
        /* Loading */
        .loading-state { text-align: center; padding: 48px 16px; }
        .loading-icon { font-size: 32px; animation: bounce 0.5s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-8px); } }
        .loading-text { margin-top: 16px; font-size: 10px; color: var(--primary); animation: blink 1s steps(2) infinite; }
        
        .empty-state { text-align: center; padding: 48px 16px; color: var(--muted-foreground); }
        .empty-icon { font-size: 32px; margin-bottom: 16px; }
        
        /* Portfolio */
        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .portfolio-card {
            padding: 16px;
            background: var(--card);
            box-shadow: 0 0 0 4px var(--border), inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #3f3f46;
        }
        
        .portfolio-card .label { font-size: 8px; color: var(--primary); margin-bottom: 8px; }
        .portfolio-card .value { font-size: 18px; color: var(--foreground); }
        .portfolio-card .value.positive { color: var(--success); }
        .portfolio-card .value.negative { color: var(--destructive); }
        .portfolio-card .sub { font-size: 8px; color: var(--muted-foreground); margin-top: 4px; }
        
        /* Form */
        .form-card {
            padding: 16px;
            margin-bottom: 16px;
            background: var(--card);
            box-shadow: 0 0 0 4px var(--primary), inset -4px -4px 0 0 #a16207, inset 4px 4px 0 0 #fef08a;
        }
        
        .form-card h3 { font-size: 10px; color: var(--primary); margin-bottom: 16px; }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .form-group label { display: block; font-size: 8px; color: var(--muted-foreground); margin-bottom: 4px; }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            font-family: inherit;
            font-size: 8px;
            color: var(--foreground);
            background: var(--background);
            border: none;
            box-shadow: inset -4px -4px 0 0 #52525b, inset 4px 4px 0 0 #18181b;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            box-shadow: inset -4px -4px 0 0 var(--primary), inset 4px 4px 0 0 #a16207;
        }
        
        /* Table */
        .table-container {
            overflow-x: auto;
            box-shadow: 0 0 0 4px var(--border), inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #3f3f46;
        }
        
        table { width: 100%; border-collapse: collapse; background: var(--card); }
        
        th {
            padding: 12px;
            text-align: left;
            font-size: 8px;
            color: var(--primary);
            background: var(--secondary);
            border-bottom: 4px solid var(--border);
        }
        
        td { padding: 12px; font-size: 8px; border-bottom: 2px solid var(--border); }
        tr:hover { background: rgba(255, 255, 255, 0.02); }
        
        .win { color: var(--success); }
        .loss { color: var(--destructive); }
        .pending { color: var(--warning); }
        
        /* Guide */
        .guide-card {
            padding: 16px;
            margin-bottom: 16px;
            background: var(--card);
            box-shadow: 0 0 0 4px var(--border), inset -4px -4px 0 0 #18181b, inset 4px 4px 0 0 #3f3f46;
        }
        
        .guide-card.is-primary {
            box-shadow: 0 0 0 4px var(--primary), inset -4px -4px 0 0 #a16207, inset 4px 4px 0 0 #fef08a, 0 0 20px rgba(250, 204, 21, 0.2);
        }
        
        .guide-card.is-error {
            box-shadow: 0 0 0 4px var(--destructive), inset -4px -4px 0 0 #b91c1c, inset 4px 4px 0 0 #f87171;
        }
        
        .guide-card h3 { font-size: 10px; color: var(--foreground); margin-bottom: 16px; }
        .guide-card.is-primary h3 { color: var(--primary); }
        .guide-card.is-error h3 { color: var(--destructive); }
        .guide-card p { font-size: 8px; color: var(--muted-foreground); line-height: 2.5; }
        .guide-card strong { color: var(--foreground); }
        
        /* Message Box */
        .message-box {
            padding: 16px;
            margin-bottom: 16px;
            background: var(--card);
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .message-box.is-success {
            box-shadow: 0 0 0 4px var(--success), inset -4px -4px 0 0 #15803d, inset 4px 4px 0 0 #4ade80;
        }
        
        .message-icon { font-size: 20px; }
        .message-content h4 { font-size: 10px; color: var(--foreground); margin-bottom: 4px; }
        .message-content p { font-size: 8px; color: var(--muted-foreground); }
        
        @media (max-width: 600px) {
            .stats-grid { grid-template-columns: repeat(3, 1fr); }
            .controls-row { flex-direction: column; align-items: stretch; }
            .nes-input { width: 100%; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <span style="font-size: 20px;">üéÆ</span>
            <span class="logo-text">POLYTRADER</span>
            <span class="logo-badge">8BIT</span>
        </div>
        <div class="status-badge" id="statusBadge">
            <div class="status-dot"></div>
            <span id="statusText">CONNECTING...</span>
        </div>
    </header>
    
    <main class="main">
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('scanner')">‚öîÔ∏è SCANNER</button>
            <button class="tab-btn" onclick="showTab('portfolio')">üí∞ PORTFOLIO</button>
            <button class="tab-btn" onclick="showTab('guide')">üìú GUIDE</button>
        </div>
        
        <div class="tab-content active" id="tab-scanner">
            <div class="controls-row">
                <div class="control-group">
                    <span class="control-label">üí∞ GOLD (USD)</span>
                    <input type="number" class="nes-input" id="bankroll" value="100">
                </div>
                <div class="control-group">
                    <span class="control-label">üéØ MIN EDGE</span>
                    <input type="number" class="nes-input" id="minEdge" value="5">
                </div>
                <button class="nes-btn is-primary" onclick="fetchMarkets()">‚ü≥ RELOAD</button>
            </div>
            
            <div class="filter-row">
                <button class="filter-btn active" onclick="filterSport('all', this)">üåê ALL</button>
                <button class="filter-btn" onclick="filterSport('nba', this)">üèÄ NBA</button>
                <button class="filter-btn" onclick="filterSport('nhl', this)">üèí NHL</button>
                <button class="filter-btn" onclick="filterSport('nfl', this)">üèà NFL</button>
                <button class="filter-btn" onclick="filterSport('soccer', this)">‚öΩ SOCCER</button>
            </div>
            
            <div class="stats-row">
                <div class="stat-badge">QUESTS:<span id="totalMarkets">0</span></div>
                <div class="stat-badge">RARE+:<span id="valueMarkets">0</span></div>
                <div class="stat-badge">TIME:<span id="lastUpdate">--:--</span></div>
            </div>
            
            <div class="quest-grid" id="questGrid">
                <div class="loading-state">
                    <div class="loading-icon">‚öîÔ∏è</div>
                    <div class="loading-text">LOADING QUESTS...</div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="tab-portfolio">
            <div class="portfolio-grid">
                <div class="portfolio-card">
                    <div class="label">üí∞ GOLD</div>
                    <div class="value" id="pBankroll">100G</div>
                    <div class="progress-bar" style="margin-top: 8px;">
                        <div class="progress-fill" id="hpFill" style="width: 100%;"></div>
                    </div>
                </div>
                <div class="portfolio-card">
                    <div class="label">üìà P&L</div>
                    <div class="value positive" id="pPnL">+0G</div>
                    <div class="sub" id="pPnLPct">0%</div>
                </div>
                <div class="portfolio-card">
                    <div class="label">üéØ WIN RATE</div>
                    <div class="value" id="pWinRate">0%</div>
                    <div class="sub" id="pWinLoss">0W - 0L</div>
                </div>
            </div>
            
            <div class="form-card">
                <h3>‚ûï NEW QUEST LOG</h3>
                <div class="form-row">
                    <div class="form-group"><label>QUEST NAME</label><input type="text" id="betEvent" placeholder="LAKERS VS CELTICS"></div>
                    <div class="form-group"><label>BET (G)</label><input type="number" id="betStake" placeholder="5"></div>
                    <div class="form-group"><label>ODDS (¬¢)</label><input type="number" id="betPrice" placeholder="55"></div>
                    <div class="form-group"><label>STATUS</label><select id="betStatus"><option value="pending">‚è≥ PENDING</option><option value="win">‚úÖ VICTORY</option><option value="loss">üíÄ DEFEAT</option></select></div>
                </div>
                <button class="nes-btn is-primary" onclick="addBet()">+ LOG QUEST</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead><tr><th>DATE</th><th>QUEST</th><th>BET</th><th>LOOT</th><th>STATUS</th><th></th></tr></thead>
                    <tbody id="betsTable"><tr><td colspan="6" style="text-align:center;">NO QUESTS LOGGED</td></tr></tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="tab-guide">
            <div class="message-box is-success">
                <span class="message-icon">‚ÑπÔ∏è</span>
                <div class="message-content">
                    <h4>Quest Guide</h4>
                    <p>Only accept quests with EDGE ‚â• 5% for maximum loot!</p>
                </div>
            </div>
            
            <div class="guide-card is-primary">
                <h3>üí∞ GOLD MANAGEMENT</h3>
                <div class="portfolio-grid" style="margin-bottom: 0;">
                    <div class="portfolio-card"><div class="label">MIN GOLD</div><div class="value">100G</div></div>
                    <div class="portfolio-card"><div class="label">BET SIZE</div><div class="value">5%</div></div>
                    <div class="portfolio-card"><div class="label">QUESTS/DAY</div><div class="value">2-3</div></div>
                </div>
            </div>
            
            <div class="guide-card">
                <h3>üìä EXPECTED LOOT (55% WIN)</h3>
                <div class="table-container">
                    <table>
                        <thead><tr><th>GOLD</th><th>BET</th><th>LOOT/MO</th><th>MAX LOSS</th></tr></thead>
                        <tbody>
                            <tr><td>100G</td><td>5G</td><td class="win">+15-25G</td><td class="loss">-30G</td></tr>
                            <tr><td>200G</td><td>10G</td><td class="win">+30-50G</td><td class="loss">-60G</td></tr>
                            <tr><td>500G</td><td>25G</td><td class="win">+75-125G</td><td class="loss">-150G</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="guide-card is-error">
                <h3>‚ö†Ô∏è WARRIOR'S CODE</h3>
                <p><strong>1.</strong> NEVER BET MORE THAN 5% PER QUEST<br><strong>2.</strong> DON'T CHASE LOSSES<br><strong>3.</strong> ONLY BET GOLD YOU CAN LOSE<br><strong>4.</strong> ONLY ACCEPT QUESTS WITH EDGE ‚â• 5%<br><strong>5.</strong> REST IF DOWN 20%</p>
            </div>
        </div>
    </main>
    
    <script>
        const API_URL = '/api/polymarket';
        let allMarkets = [];
        let currentFilter = 'all';
        let bets = JSON.parse(localStorage.getItem('polytrader_bets') || '[]');
        
        function showTab(name) {
            document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(`tab-${name}`).classList.add('active');
            if (name === 'portfolio') updatePortfolio();
        }
        
        async function fetchMarkets() {
            const grid = document.getElementById('questGrid');
            const statusBadge = document.getElementById('statusBadge');
            const statusText = document.getElementById('statusText');
            
            grid.innerHTML = '<div class="loading-state"><div class="loading-icon">‚öîÔ∏è</div><div class="loading-text">LOADING...</div></div>';
            statusBadge.className = 'status-badge loading';
            statusText.textContent = 'LOADING...';
            
            try {
                const response = await fetch(`${API_URL}?endpoint=events&closed=false&limit=100`);
                if (!response.ok) throw new Error(`ERROR ${response.status}`);
                const events = await response.json();
                
                allMarkets = events.filter(e => {
                    const t = (e.title || '').toLowerCase();
                    const s = (e.slug || '').toLowerCase();
                    return t.includes(' vs ') || s.includes('nba') || s.includes('nhl') || s.includes('nfl') || s.includes('soccer');
                }).map(e => {
                    const m = e.markets?.[0] || {};
                    let price = 0;
                    if (m.outcomePrices) { try { price = parseFloat(JSON.parse(m.outcomePrices)[0]) || 0; } catch {} }
                    let sport = 'other';
                    const t = (e.title || '').toLowerCase();
                    const s = (e.slug || '').toLowerCase();
                    if (s.includes('nba') || t.includes('lakers')) sport = 'nba';
                    else if (s.includes('nhl')) sport = 'nhl';
                    else if (s.includes('nfl')) sport = 'nfl';
                    else if (s.includes('soccer') || s.includes('premier')) sport = 'soccer';
                    return { id: e.id, title: e.title?.toUpperCase(), slug: e.slug, startDate: e.startDate, sport, price, volume: parseFloat(m.volume) || 0, url: `https://polymarket.com/event/${e.slug}` };
                }).filter(m => m.price > 0.05 && m.price < 0.95);
                
                statusBadge.className = 'status-badge';
                statusText.textContent = `LIVE ¬∑ ${allMarkets.length}`;
                document.getElementById('totalMarkets').textContent = allMarkets.length;
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'});
                renderMarkets();
            } catch (err) {
                statusBadge.className = 'status-badge error';
                statusText.textContent = 'OFFLINE';
                grid.innerHTML = `<div class="empty-state"><div class="empty-icon">üíÄ</div><p>QUEST FAILED</p><p style="margin-top:8px;color:var(--destructive);">${err.message}</p><button class="nes-btn is-primary" onclick="fetchMarkets()" style="margin-top:16px;">‚Üª RETRY</button></div>`;
            }
        }
        
        function filterSport(sport, btn) {
            currentFilter = sport;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderMarkets();
        }
        
        function renderMarkets() {
            const grid = document.getElementById('questGrid');
            let filtered = currentFilter === 'all' ? allMarkets : allMarkets.filter(m => m.sport === currentFilter);
            if (!filtered.length) { grid.innerHTML = '<div class="empty-state"><div class="empty-icon">üîç</div><p>NO QUESTS FOUND</p></div>'; return; }
            
            const icons = { nba: 'üèÄ', nhl: 'üèí', nfl: 'üèà', soccer: '‚öΩ', other: '‚öîÔ∏è' };
            
            grid.innerHTML = filtered.map((m, i) => {
                let time = '--:--';
                if (m.startDate) time = new Date(m.startDate).toLocaleString('th-TH', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
                return `<div class="quest-card" id="card-${i}"><div class="quest-header"><div><div class="quest-title">${icons[m.sport] || '‚öîÔ∏è'} ${m.title}</div><div class="quest-meta">‚è∞ ${time}</div></div><span class="quest-badge pending" id="badge-${i}">INPUT MODEL%</span></div><div class="stats-grid"><div class="stat-cell"><div class="label">PRICE</div><div class="value">${(m.price*100).toFixed(0)}¬¢</div></div><div class="stat-cell"><div class="label">IMPLIED</div><div class="value">${(m.price*100).toFixed(1)}%</div></div><div class="stat-cell"><div class="label">MODEL</div><div class="value" id="model-${i}">--</div></div><div class="stat-cell"><div class="label">EDGE</div><div class="value" id="edge-${i}">--</div></div><div class="stat-cell"><div class="label">EV</div><div class="value" id="ev-${i}">--</div></div></div><div class="quest-input"><span class="label">MODEL%:</span><input type="number" class="nes-input" id="input-${i}" placeholder="65" min="1" max="99"><button class="nes-btn is-success" onclick="calculate(${i}, ${m.price})">CALC</button></div><div class="quest-footer"><span>VOL: ${formatNum(m.volume)}G</span><a href="${m.url}" target="_blank" class="nes-btn is-primary">üéÆ TRADE</a></div></div>`;
            }).join('');
        }
        
        function calculate(i, price) {
            const model = parseFloat(document.getElementById(`input-${i}`).value);
            if (!model || model < 1 || model > 99) { alert('ENTER MODEL% (1-99)'); return; }
            const minEdge = parseFloat(document.getElementById('minEdge').value) || 5;
            const edge = model - (price * 100);
            const odds = 1 / price;
            const ev = ((model / 100) * (100 * (odds - 1))) - ((1 - model / 100) * 100);
            
            document.getElementById(`model-${i}`).textContent = `${model}%`;
            document.getElementById(`model-${i}`).className = 'value positive';
            
            const edgeEl = document.getElementById(`edge-${i}`);
            edgeEl.textContent = `${edge >= 0 ? '+' : ''}${edge.toFixed(0)}%`;
            edgeEl.className = `value ${edge >= minEdge ? 'positive' : edge >= 0 ? 'neutral' : 'negative'}`;
            
            const evEl = document.getElementById(`ev-${i}`);
            evEl.textContent = `${ev >= 0 ? '+' : ''}${ev.toFixed(0)}G`;
            evEl.className = `value ${ev >= 0 ? 'positive' : 'negative'}`;
            
            const badge = document.getElementById(`badge-${i}`);
            const card = document.getElementById(`card-${i}`);
            card.classList.remove('is-legendary', 'is-epic', 'is-rare', 'is-common');
            
            if (edge >= 10) { badge.textContent = 'üöÄ LEGENDARY'; badge.className = 'quest-badge legendary'; card.classList.add('is-legendary'); }
            else if (edge >= minEdge) { badge.textContent = '‚ú® EPIC'; badge.className = 'quest-badge epic'; card.classList.add('is-epic'); }
            else if (edge >= 0) { badge.textContent = 'üî∂ RARE'; badge.className = 'quest-badge rare'; card.classList.add('is-rare'); }
            else { badge.textContent = 'üíÄ SKIP'; badge.className = 'quest-badge common'; card.classList.add('is-common'); }
        }
        
        function addBet() {
            const event = document.getElementById('betEvent').value?.toUpperCase();
            const stake = parseFloat(document.getElementById('betStake').value);
            const price = parseFloat(document.getElementById('betPrice').value) / 100;
            const status = document.getElementById('betStatus').value;
            if (!event || !stake || !price) { alert('FILL ALL FIELDS'); return; }
            const pnl = status === 'win' ? (stake / price) - stake : status === 'loss' ? -stake : 0;
            bets.unshift({ id: Date.now(), date: new Date().toISOString(), event, stake, price, status, pnl });
            localStorage.setItem('polytrader_bets', JSON.stringify(bets));
            document.getElementById('betEvent').value = '';
            document.getElementById('betStake').value = '';
            document.getElementById('betPrice').value = '';
            updatePortfolio();
        }
        
        function updateStatus(id, status) {
            const bet = bets.find(b => b.id === id);
            if (bet) { bet.status = status; bet.pnl = status === 'win' ? (bet.stake / bet.price) - bet.stake : status === 'loss' ? -bet.stake : 0; localStorage.setItem('polytrader_bets', JSON.stringify(bets)); updatePortfolio(); }
        }
        
        function deleteBet(id) { if (confirm('DELETE?')) { bets = bets.filter(b => b.id !== id); localStorage.setItem('polytrader_bets', JSON.stringify(bets)); updatePortfolio(); } }
        
        function updatePortfolio() {
            const bankroll = parseFloat(document.getElementById('bankroll').value) || 100;
            const wins = bets.filter(b => b.status === 'win');
            const losses = bets.filter(b => b.status === 'loss');
            const totalPnL = bets.reduce((s, b) => s + b.pnl, 0);
            const current = bankroll + totalPnL;
            const winRate = wins.length + losses.length > 0 ? (wins.length / (wins.length + losses.length) * 100).toFixed(0) : 0;
            
            document.getElementById('pBankroll').textContent = `${current.toFixed(0)}G`;
            document.getElementById('pPnL').textContent = `${totalPnL >= 0 ? '+' : ''}${totalPnL.toFixed(0)}G`;
            document.getElementById('pPnL').className = `value ${totalPnL >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('pPnLPct').textContent = `${(totalPnL / bankroll * 100).toFixed(0)}%`;
            document.getElementById('pWinRate').textContent = `${winRate}%`;
            document.getElementById('pWinLoss').textContent = `${wins.length}W - ${losses.length}L`;
            document.getElementById('hpFill').style.width = `${Math.max(0, Math.min(100, (current / bankroll) * 100))}%`;
            
            const tbody = document.getElementById('betsTable');
            if (!bets.length) { tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">NO QUESTS LOGGED</td></tr>'; return; }
            tbody.innerHTML = bets.map(b => {
                const date = new Date(b.date).toLocaleDateString('th-TH', { day: 'numeric', month: 'short' });
                const pnlClass = b.status === 'win' ? 'win' : b.status === 'loss' ? 'loss' : 'pending';
                return `<tr><td>${date}</td><td>${b.event}</td><td>${b.stake}G</td><td class="${pnlClass}">${b.pnl >= 0 ? '+' : ''}${b.pnl.toFixed(0)}G</td><td><select onchange="updateStatus(${b.id}, this.value)" style="background:var(--background);border:none;color:var(--foreground);font-family:inherit;font-size:8px;padding:4px;box-shadow:inset -2px -2px 0 0 #52525b,inset 2px 2px 0 0 #18181b;"><option value="pending" ${b.status === 'pending' ? 'selected' : ''}>‚è≥</option><option value="win" ${b.status === 'win' ? 'selected' : ''}>‚úÖ</option><option value="loss" ${b.status === 'loss' ? 'selected' : ''}>üíÄ</option></select></td><td><button onclick="deleteBet(${b.id})" class="nes-btn is-error" style="padding:4px 8px;font-size:8px;">X</button></td></tr>`;
            }).join('');
        }
        
        function formatNum(n) { if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M'; if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K'; return n.toFixed(0); }
        
        fetchMarkets();
    </script>
</body>
</html>
